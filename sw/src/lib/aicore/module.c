// (C) Copyright Axelera AI 2024
// All Rights Reserved
// *** Axelera AI Confidential ***

// THIS FILE IS AUTOMATICALLY GENERATED. DO NOT MODIFY.
// Use the "blueprint-engine" to regenerate this file.

/* clang-format off */

//==================================================
// INCLUDES
//==================================================

#include "module.h"

#include <stddef.h>
#include <string.h>

#include "sdk_adapter.h"

//==================================================
// MACROS
//==================================================

//==================================================
// DEFINITIONS
//==================================================

//--------------------------------------------------
// Control Information
//--------------------------------------------------

// Common
//--------------------------------------------------

#define COMMAND_FIFO_DEPTH                                       (16)

// Address Offsets
#define ADDRESS_OFFSET_CSR                               (0x02000000)
#define ADDRESS_OFFSET_COMMAND                           (0x02800000)
#define ADDRESS_OFFSET_INSTRUCTIONS                      (0x03000000)

// DMA
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_DMA_ONE_DIM                                            (0)
#define COMMAND_FORMAT_WIDTH_DMA_ONE_DIM                                        (64)
#define COMMAND_FORMAT_SLOTS_DMA_ONE_DIM                                         (4)

#define COMMAND_FORMAT_ID_DMA_ONE_DIM_FULL                                       (1)
#define COMMAND_FORMAT_WIDTH_DMA_ONE_DIM_FULL                                   (72)
#define COMMAND_FORMAT_SLOTS_DMA_ONE_DIM_FULL                                    (5)

#define COMMAND_FORMAT_ID_DMA_TWO_DIM                                            (2)
#define COMMAND_FORMAT_WIDTH_DMA_TWO_DIM                                        (80)
#define COMMAND_FORMAT_SLOTS_DMA_TWO_DIM                                         (5)

#define COMMAND_FORMAT_ID_DMA_TWO_DIM_FULL                                       (3)
#define COMMAND_FORMAT_WIDTH_DMA_TWO_DIM_FULL                                   (88)
#define COMMAND_FORMAT_SLOTS_DMA_TWO_DIM_FULL                                    (6)

#define COMMAND_FORMAT_ID_DMA_LINKED_LIST                                        (4)
#define COMMAND_FORMAT_WIDTH_DMA_LINKED_LIST                                    (32)
#define COMMAND_FORMAT_SLOTS_DMA_LINKED_LIST                                     (2)

// Instructions
#define INSTR_WIDTH_DMA                                                          (0)
#define INSTR_MAX_COUNT_DMA                                                      (0)

// DPU
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_DPU_LOOP_M1_N0                                         (0)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M1_N0                                     (16)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M1_N0                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M1_N1                                         (1)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M1_N1                                     (24)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M1_N1                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M1_N2                                         (2)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M1_N2                                     (32)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M1_N2                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M2_N0                                         (3)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M2_N0                                     (24)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M2_N0                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M2_N1                                         (4)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M2_N1                                     (32)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M2_N1                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M2_N2                                         (5)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M2_N2                                     (40)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M2_N2                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M3_N0                                         (6)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M3_N0                                     (32)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M3_N0                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M3_N1                                         (7)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M3_N1                                     (40)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M3_N1                                      (1)

#define COMMAND_FORMAT_ID_DPU_LOOP_M3_N2                                         (8)
#define COMMAND_FORMAT_WIDTH_DPU_LOOP_M3_N2                                     (48)
#define COMMAND_FORMAT_SLOTS_DPU_LOOP_M3_N2                                      (1)

#define COMMAND_FORMAT_ID_DPU_BYPASS                                             (9)
#define COMMAND_FORMAT_WIDTH_DPU_BYPASS                                          (8)
#define COMMAND_FORMAT_SLOTS_DPU_BYPASS                                          (1)

// Instructions
#define INSTR_WIDTH_DPU                                                         (32)
#define INSTR_MAX_COUNT_DPU                                                   (1024)

// DWPU
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_DWPU_LOOP_M1_N0                                        (0)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M1_N0                                    (16)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M1_N0                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M1_N1                                        (1)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M1_N1                                    (24)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M1_N1                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M1_N2                                        (2)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M1_N2                                    (32)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M1_N2                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M2_N0                                        (3)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M2_N0                                    (24)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M2_N0                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M2_N1                                        (4)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M2_N1                                    (32)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M2_N1                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M2_N2                                        (5)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M2_N2                                    (40)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M2_N2                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M3_N0                                        (6)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M3_N0                                    (32)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M3_N0                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M3_N1                                        (7)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M3_N1                                    (40)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M3_N1                                     (1)

#define COMMAND_FORMAT_ID_DWPU_LOOP_M3_N2                                        (8)
#define COMMAND_FORMAT_WIDTH_DWPU_LOOP_M3_N2                                    (48)
#define COMMAND_FORMAT_SLOTS_DWPU_LOOP_M3_N2                                     (1)

#define COMMAND_FORMAT_ID_DWPU_BYPASS                                            (9)
#define COMMAND_FORMAT_WIDTH_DWPU_BYPASS                                         (8)
#define COMMAND_FORMAT_SLOTS_DWPU_BYPASS                                         (1)

// Instructions
#define INSTR_WIDTH_DWPU                                                       (128)
#define INSTR_MAX_COUNT_DWPU                                                  (1024)

// IAU
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_IAU_LOOP_M1_N0                                         (0)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M1_N0                                     (16)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M1_N0                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M1_N1                                         (1)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M1_N1                                     (24)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M1_N1                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M1_N2                                         (2)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M1_N2                                     (32)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M1_N2                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M2_N0                                         (3)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M2_N0                                     (24)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M2_N0                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M2_N1                                         (4)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M2_N1                                     (32)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M2_N1                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M2_N2                                         (5)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M2_N2                                     (40)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M2_N2                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M3_N0                                         (6)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M3_N0                                     (32)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M3_N0                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M3_N1                                         (7)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M3_N1                                     (40)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M3_N1                                      (1)

#define COMMAND_FORMAT_ID_IAU_LOOP_M3_N2                                         (8)
#define COMMAND_FORMAT_WIDTH_IAU_LOOP_M3_N2                                     (48)
#define COMMAND_FORMAT_SLOTS_IAU_LOOP_M3_N2                                      (1)

#define COMMAND_FORMAT_ID_IAU_BYPASS                                             (9)
#define COMMAND_FORMAT_WIDTH_IAU_BYPASS                                          (8)
#define COMMAND_FORMAT_SLOTS_IAU_BYPASS                                          (1)

// Instructions
#define INSTR_WIDTH_IAU                                                         (16)
#define INSTR_MAX_COUNT_IAU                                                    (256)

// IFD_ODR
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_IFD_ODR_DEF_BASED                                      (0)
#define COMMAND_FORMAT_WIDTH_IFD_ODR_DEF_BASED                                  (32)
#define COMMAND_FORMAT_SLOTS_IFD_ODR_DEF_BASED                                   (1)

#define COMMAND_FORMAT_ID_IFD_ODR_LINEAR                                         (1)
#define COMMAND_FORMAT_WIDTH_IFD_ODR_LINEAR                                     (16)
#define COMMAND_FORMAT_SLOTS_IFD_ODR_LINEAR                                      (1)

#define COMMAND_FORMAT_ID_IFD_ODR_THREE_DIM_FALLBACK                             (2)
#define COMMAND_FORMAT_WIDTH_IFD_ODR_THREE_DIM_FALLBACK                         (72)
#define COMMAND_FORMAT_SLOTS_IFD_ODR_THREE_DIM_FALLBACK                          (2)

#define COMMAND_FORMAT_ID_IFD_ODR_OFFSET_DEF_BASED                               (3)
#define COMMAND_FORMAT_WIDTH_IFD_ODR_OFFSET_DEF_BASED                           (40)
#define COMMAND_FORMAT_SLOTS_IFD_ODR_OFFSET_DEF_BASED                            (1)

#define COMMAND_FORMAT_ID_IFD_ODR_FOUR_DIM_FALLBACK                              (4)
#define COMMAND_FORMAT_WIDTH_IFD_ODR_FOUR_DIM_FALLBACK                          (88)
#define COMMAND_FORMAT_SLOTS_IFD_ODR_FOUR_DIM_FALLBACK                           (3)

// Instructions
#define INSTR_WIDTH_IFD_ODR                                                     (64)
#define INSTR_MAX_COUNT_IFD_ODR                                                (128)

// MVMEXE
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M1_N0                                      (0)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M1_N0                                  (16)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M1_N0                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M1_N1                                      (1)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M1_N1                                  (24)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M1_N1                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M1_N2                                      (2)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M1_N2                                  (32)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M1_N2                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M2_N0                                      (3)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M2_N0                                  (24)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M2_N0                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M2_N1                                      (4)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M2_N1                                  (32)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M2_N1                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M2_N2                                      (5)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M2_N2                                  (40)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M2_N2                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M3_N0                                      (6)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M3_N0                                  (32)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M3_N0                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M3_N1                                      (7)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M3_N1                                  (40)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M3_N1                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_LOOP_M3_N2                                      (8)
#define COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M3_N2                                  (48)
#define COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M3_N2                                   (1)

#define COMMAND_FORMAT_ID_MVMEXE_BYPASS                                          (9)
#define COMMAND_FORMAT_WIDTH_MVMEXE_BYPASS                                       (8)
#define COMMAND_FORMAT_SLOTS_MVMEXE_BYPASS                                       (1)

// Instructions
#define INSTR_WIDTH_MVMEXE                                                      (16)
#define INSTR_MAX_COUNT_MVMEXE                                                 (256)

// MVMPRG
//--------------------------------------------------

// Command Formats
#define COMMAND_FORMAT_ID_MVMPRG_STANDARD                                        (0)
#define COMMAND_FORMAT_WIDTH_MVMPRG_STANDARD                                    (16)
#define COMMAND_FORMAT_SLOTS_MVMPRG_STANDARD                                     (1)

// Instructions
#define INSTR_WIDTH_MVMPRG                                                       (0)
#define INSTR_MAX_COUNT_MVMPRG                                                   (0)

//--------------------------------------------------
// Module Information
//--------------------------------------------------

// Block IDs
#define BLOCK_ID_D_DPU                                         (0x3B)
#define BLOCK_ID_D_DWPU                                        (0x49)
#define BLOCK_ID_D_IAU                                         (0xE0)
#define BLOCK_ID_D_IFD_0                                       (0xBD)
#define BLOCK_ID_D_IFD_1                                       (0x4B)
#define BLOCK_ID_D_ODR                                         (0x71)
#define BLOCK_ID_HP_DMA_0                                      (0x25)
#define BLOCK_ID_HP_DMA_1                                      (0xFA)
#define BLOCK_ID_M_DPU                                         (0x7D)
#define BLOCK_ID_M_IAU                                         (0x84)
#define BLOCK_ID_M_IFD_0                                       (0x74)
#define BLOCK_ID_M_IFD_1                                       (0xE4)
#define BLOCK_ID_M_IFD_2                                       (0x3F)
#define BLOCK_ID_M_IFD_W                                       (0x28)
#define BLOCK_ID_M_MVMEXE                                      (0xF2)
#define BLOCK_ID_M_MVMPRG                                      (0xF2)
#define BLOCK_ID_M_ODR                                         (0x30)

// Address Offsets
#define ADDRESS_OFFSET_MODULE_D_DPU                      (0x00420000)
#define ADDRESS_OFFSET_MODULE_D_DWPU                     (0x00400000)
#define ADDRESS_OFFSET_MODULE_D_IAU                      (0x00410000)
#define ADDRESS_OFFSET_MODULE_D_IFD_0                    (0x00050000)
#define ADDRESS_OFFSET_MODULE_D_IFD_1                    (0x00060000)
#define ADDRESS_OFFSET_MODULE_D_ODR                      (0x00070000)
#define ADDRESS_OFFSET_MODULE_HP_DMA_0                   (0x00600000)
#define ADDRESS_OFFSET_MODULE_HP_DMA_1                   (0x00610000)
#define ADDRESS_OFFSET_MODULE_M_DPU                      (0x00230000)
#define ADDRESS_OFFSET_MODULE_M_IAU                      (0x00220000)
#define ADDRESS_OFFSET_MODULE_M_IFD_0                    (0x00000000)
#define ADDRESS_OFFSET_MODULE_M_IFD_1                    (0x00010000)
#define ADDRESS_OFFSET_MODULE_M_IFD_2                    (0x00020000)
#define ADDRESS_OFFSET_MODULE_M_IFD_W                    (0x00030000)
#define ADDRESS_OFFSET_MODULE_M_MVMEXE                   (0x00200000)
#define ADDRESS_OFFSET_MODULE_M_MVMPRG                   (0x00210000)
#define ADDRESS_OFFSET_MODULE_M_ODR                      (0x00040000)

//--------------------------------------------------
// CSR Information
//--------------------------------------------------


//==================================================
// TYPES
//==================================================

//--------------------------------------------------
// Common CSRs
//--------------------------------------------------

// Registers
//--------------------------------------------------

typedef struct {
  uint64_t exec_en : 1;
  uint64_t ptr_rst : 1;
  uint64_t __reserved_2__ : 62;
} csr_register_cmdblk_ctrl_t;

typedef struct {
  uint64_t state : 2;
  uint64_t wait_token : 1;
  uint64_t __reserved_2__ : 5;
  uint64_t in_word_ptr : 8;
  uint64_t fifo_cnt : 8;
  uint64_t outst_cmds : 8;
  uint64_t __reserved_6__ : 16;
  uint64_t __reserved_7__ : 16;
} csr_register_cmdblk_status_t;

typedef struct {
  uint64_t scratch : 64;
} csr_register_dbg_scratch_t;

typedef struct {
  uint64_t block_id : 8;
  uint64_t ai_core_id : 8;
  uint64_t hw_revision : 8;
  uint64_t __reserved_3__ : 40;
} csr_register_dbg_id_t;


// CSR
//--------------------------------------------------

typedef struct {
  csr_register_cmdblk_ctrl_t cmdblk_ctrl;
  csr_register_cmdblk_status_t cmdblk_status;
  uint64_t __reserved_2__;
  uint64_t __reserved_3__;
  uint64_t __reserved_4__;
  uint64_t __reserved_5__;
  uint64_t __reserved_6__;
  uint64_t __reserved_7__;
  csr_register_dbg_scratch_t dbg_scratch;
  csr_register_dbg_id_t dbg_id;
  uint64_t __reserved_10__;
  uint64_t __reserved_11__;
  uint64_t __reserved_12__;
  uint64_t __reserved_13__;
  uint64_t __reserved_14__;
  uint64_t __reserved_15__;
} csr_t;

//--------------------------------------------------
// Info LUT
//--------------------------------------------------

typedef uint8_t command_format_id_t;

typedef struct {
  uint8_t width;
  uint8_t used_slots;
} command_format_info_t;

typedef struct {
  const char* name;
  uint8_t block_id;
  uintptr_t base_addr;
  volatile csr_t* csr;
  volatile uint64_t* command_fifo;
  volatile uint8_t* instruction_memory;
  const command_format_info_t* command_format_infos;
  uint8_t instr_size;
  uint16_t instr_max_count;
} module_info_t;

//==================================================
// DATA
//==================================================

static const command_format_info_t dma_command_format_infos[] = {
  [COMMAND_FORMAT_ID_DMA_ONE_DIM] = { .width = COMMAND_FORMAT_WIDTH_DMA_ONE_DIM, .used_slots = COMMAND_FORMAT_SLOTS_DMA_ONE_DIM },
  [COMMAND_FORMAT_ID_DMA_ONE_DIM_FULL] = { .width = COMMAND_FORMAT_WIDTH_DMA_ONE_DIM_FULL, .used_slots = COMMAND_FORMAT_SLOTS_DMA_ONE_DIM_FULL },
  [COMMAND_FORMAT_ID_DMA_TWO_DIM] = { .width = COMMAND_FORMAT_WIDTH_DMA_TWO_DIM, .used_slots = COMMAND_FORMAT_SLOTS_DMA_TWO_DIM },
  [COMMAND_FORMAT_ID_DMA_TWO_DIM_FULL] = { .width = COMMAND_FORMAT_WIDTH_DMA_TWO_DIM_FULL, .used_slots = COMMAND_FORMAT_SLOTS_DMA_TWO_DIM_FULL },
  [COMMAND_FORMAT_ID_DMA_LINKED_LIST] = { .width = COMMAND_FORMAT_WIDTH_DMA_LINKED_LIST, .used_slots = COMMAND_FORMAT_SLOTS_DMA_LINKED_LIST }
};

static const command_format_info_t dpu_command_format_infos[] = {
  [COMMAND_FORMAT_ID_DPU_LOOP_M1_N0] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M1_N0, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M1_N0 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M1_N1] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M1_N1, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M1_N1 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M1_N2] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M1_N2, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M1_N2 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M2_N0] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M2_N0, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M2_N0 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M2_N1] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M2_N1, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M2_N1 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M2_N2] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M2_N2, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M2_N2 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M3_N0] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M3_N0, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M3_N0 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M3_N1] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M3_N1, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M3_N1 },
  [COMMAND_FORMAT_ID_DPU_LOOP_M3_N2] = { .width = COMMAND_FORMAT_WIDTH_DPU_LOOP_M3_N2, .used_slots = COMMAND_FORMAT_SLOTS_DPU_LOOP_M3_N2 },
  [COMMAND_FORMAT_ID_DPU_BYPASS] = { .width = COMMAND_FORMAT_WIDTH_DPU_BYPASS, .used_slots = COMMAND_FORMAT_SLOTS_DPU_BYPASS }
};

static const command_format_info_t dwpu_command_format_infos[] = {
  [COMMAND_FORMAT_ID_DWPU_LOOP_M1_N0] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M1_N0, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M1_N0 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M1_N1] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M1_N1, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M1_N1 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M1_N2] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M1_N2, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M1_N2 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M2_N0] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M2_N0, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M2_N0 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M2_N1] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M2_N1, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M2_N1 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M2_N2] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M2_N2, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M2_N2 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M3_N0] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M3_N0, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M3_N0 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M3_N1] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M3_N1, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M3_N1 },
  [COMMAND_FORMAT_ID_DWPU_LOOP_M3_N2] = { .width = COMMAND_FORMAT_WIDTH_DWPU_LOOP_M3_N2, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_LOOP_M3_N2 },
  [COMMAND_FORMAT_ID_DWPU_BYPASS] = { .width = COMMAND_FORMAT_WIDTH_DWPU_BYPASS, .used_slots = COMMAND_FORMAT_SLOTS_DWPU_BYPASS }
};

static const command_format_info_t iau_command_format_infos[] = {
  [COMMAND_FORMAT_ID_IAU_LOOP_M1_N0] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M1_N0, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M1_N0 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M1_N1] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M1_N1, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M1_N1 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M1_N2] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M1_N2, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M1_N2 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M2_N0] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M2_N0, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M2_N0 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M2_N1] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M2_N1, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M2_N1 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M2_N2] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M2_N2, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M2_N2 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M3_N0] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M3_N0, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M3_N0 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M3_N1] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M3_N1, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M3_N1 },
  [COMMAND_FORMAT_ID_IAU_LOOP_M3_N2] = { .width = COMMAND_FORMAT_WIDTH_IAU_LOOP_M3_N2, .used_slots = COMMAND_FORMAT_SLOTS_IAU_LOOP_M3_N2 },
  [COMMAND_FORMAT_ID_IAU_BYPASS] = { .width = COMMAND_FORMAT_WIDTH_IAU_BYPASS, .used_slots = COMMAND_FORMAT_SLOTS_IAU_BYPASS }
};

static const command_format_info_t ifd_odr_command_format_infos[] = {
  [COMMAND_FORMAT_ID_IFD_ODR_DEF_BASED] = { .width = COMMAND_FORMAT_WIDTH_IFD_ODR_DEF_BASED, .used_slots = COMMAND_FORMAT_SLOTS_IFD_ODR_DEF_BASED },
  [COMMAND_FORMAT_ID_IFD_ODR_LINEAR] = { .width = COMMAND_FORMAT_WIDTH_IFD_ODR_LINEAR, .used_slots = COMMAND_FORMAT_SLOTS_IFD_ODR_LINEAR },
  [COMMAND_FORMAT_ID_IFD_ODR_THREE_DIM_FALLBACK] = { .width = COMMAND_FORMAT_WIDTH_IFD_ODR_THREE_DIM_FALLBACK, .used_slots = COMMAND_FORMAT_SLOTS_IFD_ODR_THREE_DIM_FALLBACK },
  [COMMAND_FORMAT_ID_IFD_ODR_OFFSET_DEF_BASED] = { .width = COMMAND_FORMAT_WIDTH_IFD_ODR_OFFSET_DEF_BASED, .used_slots = COMMAND_FORMAT_SLOTS_IFD_ODR_OFFSET_DEF_BASED },
  [COMMAND_FORMAT_ID_IFD_ODR_FOUR_DIM_FALLBACK] = { .width = COMMAND_FORMAT_WIDTH_IFD_ODR_FOUR_DIM_FALLBACK, .used_slots = COMMAND_FORMAT_SLOTS_IFD_ODR_FOUR_DIM_FALLBACK }
};

static const command_format_info_t mvmexe_command_format_infos[] = {
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M1_N0] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M1_N0, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M1_N0 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M1_N1] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M1_N1, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M1_N1 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M1_N2] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M1_N2, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M1_N2 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M2_N0] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M2_N0, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M2_N0 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M2_N1] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M2_N1, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M2_N1 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M2_N2] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M2_N2, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M2_N2 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M3_N0] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M3_N0, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M3_N0 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M3_N1] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M3_N1, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M3_N1 },
  [COMMAND_FORMAT_ID_MVMEXE_LOOP_M3_N2] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_LOOP_M3_N2, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_LOOP_M3_N2 },
  [COMMAND_FORMAT_ID_MVMEXE_BYPASS] = { .width = COMMAND_FORMAT_WIDTH_MVMEXE_BYPASS, .used_slots = COMMAND_FORMAT_SLOTS_MVMEXE_BYPASS }
};

static const command_format_info_t mvmprg_command_format_infos[] = {
  [COMMAND_FORMAT_ID_MVMPRG_STANDARD] = { .width = COMMAND_FORMAT_WIDTH_MVMPRG_STANDARD, .used_slots = COMMAND_FORMAT_SLOTS_MVMPRG_STANDARD }
};

static module_info_t module_infos[] = {
  [MODULE_ID_D_DPU] = {
    .name = "d_dpu",
    .block_id = BLOCK_ID_D_DPU,
    .base_addr = ADDRESS_OFFSET_MODULE_D_DPU,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_D_DPU + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_D_DPU + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_D_DPU + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = dpu_command_format_infos,
    .instr_size = INSTR_WIDTH_DPU / 8,
    .instr_max_count = INSTR_MAX_COUNT_DPU
  },
  [MODULE_ID_D_DWPU] = {
    .name = "d_dwpu",
    .block_id = BLOCK_ID_D_DWPU,
    .base_addr = ADDRESS_OFFSET_MODULE_D_DWPU,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_D_DWPU + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_D_DWPU + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_D_DWPU + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = dwpu_command_format_infos,
    .instr_size = INSTR_WIDTH_DWPU / 8,
    .instr_max_count = INSTR_MAX_COUNT_DWPU
  },
  [MODULE_ID_D_IAU] = {
    .name = "d_iau",
    .block_id = BLOCK_ID_D_IAU,
    .base_addr = ADDRESS_OFFSET_MODULE_D_IAU,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_D_IAU + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_D_IAU + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_D_IAU + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = iau_command_format_infos,
    .instr_size = INSTR_WIDTH_IAU / 8,
    .instr_max_count = INSTR_MAX_COUNT_IAU
  },
  [MODULE_ID_D_IFD_0] = {
    .name = "d_ifd_0",
    .block_id = BLOCK_ID_D_IFD_0,
    .base_addr = ADDRESS_OFFSET_MODULE_D_IFD_0,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_D_IFD_0 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_D_IFD_0 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_D_IFD_0 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_D_IFD_1] = {
    .name = "d_ifd_1",
    .block_id = BLOCK_ID_D_IFD_1,
    .base_addr = ADDRESS_OFFSET_MODULE_D_IFD_1,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_D_IFD_1 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_D_IFD_1 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_D_IFD_1 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_D_ODR] = {
    .name = "d_odr",
    .block_id = BLOCK_ID_D_ODR,
    .base_addr = ADDRESS_OFFSET_MODULE_D_ODR,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_D_ODR + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_D_ODR + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_D_ODR + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_HP_DMA_0] = {
    .name = "hp_dma_0",
    .block_id = BLOCK_ID_HP_DMA_0,
    .base_addr = ADDRESS_OFFSET_MODULE_HP_DMA_0,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_HP_DMA_0 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_HP_DMA_0 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_HP_DMA_0 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = dma_command_format_infos,
    .instr_size = INSTR_WIDTH_DMA / 8,
    .instr_max_count = INSTR_MAX_COUNT_DMA
  },
  [MODULE_ID_HP_DMA_1] = {
    .name = "hp_dma_1",
    .block_id = BLOCK_ID_HP_DMA_1,
    .base_addr = ADDRESS_OFFSET_MODULE_HP_DMA_1,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_HP_DMA_1 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_HP_DMA_1 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_HP_DMA_1 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = dma_command_format_infos,
    .instr_size = INSTR_WIDTH_DMA / 8,
    .instr_max_count = INSTR_MAX_COUNT_DMA
  },
  [MODULE_ID_M_DPU] = {
    .name = "m_dpu",
    .block_id = BLOCK_ID_M_DPU,
    .base_addr = ADDRESS_OFFSET_MODULE_M_DPU,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_DPU + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_DPU + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_DPU + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = dpu_command_format_infos,
    .instr_size = INSTR_WIDTH_DPU / 8,
    .instr_max_count = INSTR_MAX_COUNT_DPU
  },
  [MODULE_ID_M_IAU] = {
    .name = "m_iau",
    .block_id = BLOCK_ID_M_IAU,
    .base_addr = ADDRESS_OFFSET_MODULE_M_IAU,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_IAU + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_IAU + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_IAU + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = iau_command_format_infos,
    .instr_size = INSTR_WIDTH_IAU / 8,
    .instr_max_count = INSTR_MAX_COUNT_IAU
  },
  [MODULE_ID_M_IFD_0] = {
    .name = "m_ifd_0",
    .block_id = BLOCK_ID_M_IFD_0,
    .base_addr = ADDRESS_OFFSET_MODULE_M_IFD_0,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_IFD_0 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_IFD_0 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_IFD_0 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_M_IFD_1] = {
    .name = "m_ifd_1",
    .block_id = BLOCK_ID_M_IFD_1,
    .base_addr = ADDRESS_OFFSET_MODULE_M_IFD_1,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_IFD_1 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_IFD_1 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_IFD_1 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_M_IFD_2] = {
    .name = "m_ifd_2",
    .block_id = BLOCK_ID_M_IFD_2,
    .base_addr = ADDRESS_OFFSET_MODULE_M_IFD_2,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_IFD_2 + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_IFD_2 + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_IFD_2 + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_M_IFD_W] = {
    .name = "m_ifd_w",
    .block_id = BLOCK_ID_M_IFD_W,
    .base_addr = ADDRESS_OFFSET_MODULE_M_IFD_W,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_IFD_W + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_IFD_W + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_IFD_W + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
  [MODULE_ID_M_MVMEXE] = {
    .name = "m_mvmexe",
    .block_id = BLOCK_ID_M_MVMEXE,
    .base_addr = ADDRESS_OFFSET_MODULE_M_MVMEXE,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_MVMEXE + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_MVMEXE + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_MVMEXE + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = mvmexe_command_format_infos,
    .instr_size = INSTR_WIDTH_MVMEXE / 8,
    .instr_max_count = INSTR_MAX_COUNT_MVMEXE
  },
  [MODULE_ID_M_MVMPRG] = {
    .name = "m_mvmprg",
    .block_id = BLOCK_ID_M_MVMPRG,
    .base_addr = ADDRESS_OFFSET_MODULE_M_MVMPRG,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_MVMPRG + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_MVMPRG + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_MVMPRG + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = mvmprg_command_format_infos,
    .instr_size = INSTR_WIDTH_MVMPRG / 8,
    .instr_max_count = INSTR_MAX_COUNT_MVMPRG
  },
  [MODULE_ID_M_ODR] = {
    .name = "m_odr",
    .block_id = BLOCK_ID_M_ODR,
    .base_addr = ADDRESS_OFFSET_MODULE_M_ODR,
    .csr = (volatile csr_t*) (ADDRESS_OFFSET_MODULE_M_ODR + ADDRESS_OFFSET_CSR),
    .command_fifo = (volatile uint64_t*) (ADDRESS_OFFSET_MODULE_M_ODR + ADDRESS_OFFSET_COMMAND),
    .instruction_memory = (volatile uint8_t*) (ADDRESS_OFFSET_MODULE_M_ODR + ADDRESS_OFFSET_INSTRUCTIONS),
    .command_format_infos = ifd_odr_command_format_infos,
    .instr_size = INSTR_WIDTH_IFD_ODR / 8,
    .instr_max_count = INSTR_MAX_COUNT_IFD_ODR
  },
};

//==================================================
// LOCAL FUNCTION DECLARATIONS
//==================================================

static module_status_t fifo_push_words(volatile uint64_t* dst, const volatile uint64_t* src, size_t size);
static void volatile_memcpy(volatile void* dst, const volatile void* src, size_t size);

//==================================================
// LOCAL FUNCTION DEFINITIONS
//==================================================

static module_status_t fifo_push_words(volatile uint64_t* const dst, const volatile uint64_t* const src, size_t size) {
  // The FIFO is 64-bit wide, so we need to align the size to the next 64-bit boundary
  if (size % sizeof(uint64_t) != 0) {
    LOG_ERROR("Size is not a multiple of 64 bits!");
    return MODULE_STATUS_ERROR;
  }

  const uint64_t words = size / sizeof(uint64_t);

  for (uint64_t i = 0; i < words; i++) {
    *dst = src[i];
  }

  return MODULE_STATUS_OK;
}

static void volatile_memcpy(volatile void* dst, const volatile void* src, size_t size) {
  volatile uint8_t* dst_c = (volatile uint8_t*) dst;
  const volatile uint8_t* src_c = (const volatile uint8_t*) src;
  // Copy bytes until src_c is 8B aligned
  while (((uintptr_t) src_c % 8 != 0) && (size > 0)) {
    *(dst_c++) = *(src_c++);
    size--;
  }
  // If src_c and dst_c are 8B aligned, copy words as long as possible
  if (((uintptr_t) src_c % 8 == 0) && ((uintptr_t) dst_c % 8 == 0)) {
    while (size >= 8) {
      *(volatile uint64_t*) dst_c = *(const uint64_t*) src_c;
      src_c += 8;
      dst_c += 8;
      size -= 8;
    }
  }
  // Copy the remaining bytes
  while (size > 0) {
    *(dst_c++) = *(src_c++);
    size--;
  }
}

//==================================================
// GLOBAL FUNCTION DEFINITIONS
//==================================================

const char* module_get_name(module_id_t module_id) {
  return module_infos[module_id].name;
}

module_status_t module_init(void) {
  // NOTE(yruff): We currently need to initialise this variable to a non-zero value. Currently there are
  // some caveats with global variables for Voyager SDK megakernels (see SDK-4047).
  static bool run_init = true;

  if (run_init) {
    const uintptr_t core_base_addr = get_core_base_address();

    LOG_DEBUG("Initialize module driver (%p)", (void*)core_base_addr);

    // Initialize base addresses by patching the offsets with the core's base address
    for (module_id_t module_id = 0; module_id < MODULE_COUNT; module_id++) {
      module_info_t* module_info = &module_infos[module_id];
      module_info->base_addr = (module_info->base_addr + core_base_addr);
      module_info->csr = (csr_t*) ((uint8_t*) module_info->csr + core_base_addr);
      module_info->command_fifo = (uint64_t*) ((uint8_t*) module_info->command_fifo + core_base_addr);
      module_info->instruction_memory = (uint8_t*) ((uint8_t*) module_info->instruction_memory + core_base_addr);
    }

    run_init = false;
  }

  return MODULE_STATUS_OK;
}

module_status_t module_enable_execution(module_id_t module_id) {
  LOG_DEBUG("Enable module (%s)", module_get_name(module_id));

  csr_register_cmdblk_ctrl_t cmdblk_ctrl = module_infos[module_id].csr->cmdblk_ctrl;

  cmdblk_ctrl.exec_en = 1;
  module_infos[module_id].csr->cmdblk_ctrl = cmdblk_ctrl;

  return MODULE_STATUS_OK;
}

module_status_t module_disable_execution(module_id_t module_id) {
  LOG_DEBUG("Disable module (%s)", module_get_name(module_id));

  csr_register_cmdblk_ctrl_t cmdblk_ctrl = module_infos[module_id].csr->cmdblk_ctrl;

  cmdblk_ctrl.exec_en = 0;
  module_infos[module_id].csr->cmdblk_ctrl = cmdblk_ctrl;

  return MODULE_STATUS_OK;
}

module_status_t module_poll_idle(module_id_t module_id) {
  csr_register_cmdblk_status_t cmdblk_status;

  LOG_INFO("Wait for module (%s)", module_get_name(module_id));

  do {
    cmdblk_status = module_infos[module_id].csr->cmdblk_status;
  } while (cmdblk_status.state != 0);

  return MODULE_STATUS_OK;
}

module_status_t module_clear_instructions(module_id_t module_id) {
  // Clear the instruction memory by writing zeros to it
  // TODO(schmuck): is it dangerous to use memset (non-volatile) here?
  memset(
    (uint8_t*) module_infos[module_id].instruction_memory,
    0,
    module_infos[module_id].instr_max_count * module_infos[module_id].instr_size
  );

  return MODULE_STATUS_OK;
}

module_status_t module_load_command(module_id_t module_id, module_command_t* command) {
  LOG_INFO("Load command (%s)", module_get_name(module_id));

  command_format_id_t command_format = command->header.command_format;
  uint8_t cmd_fifo_count;

  // Poll until a command FIFO slot becomes available
  do {
    const csr_register_cmdblk_status_t cmdblk_status = module_infos[module_id].csr->cmdblk_status;
    cmd_fifo_count = cmdblk_status.fifo_cnt;

  } while (
    cmd_fifo_count + module_infos[module_id].command_format_infos[command_format].used_slots
    >= COMMAND_FIFO_DEPTH
  );

  // Push the command into the FIFO (multiple words might be necessary for wider commands)
  LOG_DEBUG("Push %d words into the FIFO", module_infos[module_id].command_format_infos[command_format].width);
  fifo_push_words(
    (uint64_t*) (module_infos[module_id].command_fifo),
    (uint64_t*) command,
    module_infos[module_id].command_format_infos[command_format].width
  );

  return MODULE_STATUS_OK;
}

module_status_t module_load_instructions(module_id_t module_id, void* instructions, uint16_t count, uint16_t offset) {
  LOG_INFO("Load instructions (%s, %d, %d)", module_get_name(module_id), count, offset);

  const module_info_t* module_info = &module_infos[module_id];

  // Check if there is any space left in the instruction memory
  if (count + offset > module_info->instr_max_count) {
    return MODULE_STATUS_ERROR;
  }

  // Write the instructions into the descriptor memory
  //  (multiple words per instruction might be necessary for wider instructions)
  LOG_DEBUG("Copying %d bytes from %p to %p", count * module_info->instr_size, instructions, module_info->instruction_memory + offset * module_info->instr_size);
  volatile_memcpy(
    (volatile uint8_t*) (module_info->instruction_memory + offset * module_info->instr_size),
    (const uint8_t*) instructions,
    count * module_info->instr_size
  );

  return MODULE_STATUS_OK;
}
