// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>
//         Matteo Perotti <mperotti@iis.ee.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //               33.9375,  31.7344, -56.0000, -62.0625,  77.6875, -7.7383,
  //               -75.3750,  4.1953,  79.5625, -87.3750,
  //               -37.2188,  90.5000,  68.0625,  69.0625,  54.0312, -64.6875
  VLOAD_16(v2, 0x503e, 0x4fef, 0xd300, 0xd3c2, 0x54db, 0xc7bd, 0xd4b6, 0x4432, 0x54f9, 0xd576, 0xd0a7, 0x55a8, 0x5441,
           0x5451, 0x52c1, 0xd40b);
  //              -92.3125, -75.9375,  26.1094,
  //              -79.6875,  3.9375,  37.2812,  50.7812, -3.9375, -55.9688,
  //              -31.5312,  76.0000,  69.1875, -8.2578, -52.5000,
  //              -98.4375,  40.3438
  VLOAD_16(v6, 0xd5c5, 0xd4bf, 0x4e87, 0xd4fb, 0x43e0, 0x50a9, 0x5259, 0xc3e0, 0xd2ff, 0xcfe2, 0x54c0, 0x5453, 0xc821,
           0xd290, 0xd627, 0x510b);
  //               75.62483215,  29.19676971,  69.45310211, -70.36167145,
  //               -0.92180759, -77.84928131,  86.66299438, -43.34124756,
  //               -3.36894345,  7.33576536, -64.43717194, -80.48993683,
  //               -5.57641745,  89.34833527, -39.19780731, -55.64332581
  VLOAD_32(v4, 0x42973fea, 0x41e992fc, 0x428ae7fd, 0xc28cb92d, 0xbf6bfb95, 0xc29bb2d5, 0x42ad5374, 0xc22d5d70,
           0xc0579cc5, 0x40eabe97, 0xc280dfd5, 0xc2a0fad9, 0xc0b27203, 0x42b2b259, 0xc21cca8e, 0xc25e92c4);
  asm volatile("vfwnmacc.vv v4, v2, v6");
  //               3057.23071289,  2380.63232422,  1392.67187500,
  //               -4875.24365234, -304.97271729,  366.34207153,
  //               3740.97363281,  59.86029053,  4456.38281250, -2762.37866211,
  //               2893.06225586, -6180.97900391,  567.62377930,  3536.43286133,
  //               5357.89892578,  2665.37963867
  VCMP_U32(1, v4, 0x453f13b1, 0x4514ca1e, 0x44ae1580, 0xc59859f3, 0xc3987c82, 0x43b72bc9, 0x4569cf94, 0x426f70f0,
           0x458b4310, 0xc52ca60f, 0x4534d0ff, 0xc5c127d5, 0x440de7ec, 0x455d06ed, 0x45a76f31, 0x45269613);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //               33.9375,  31.7344, -56.0000, -62.0625,  77.6875, -7.7383,
  //               -75.3750,  4.1953,  79.5625, -87.3750,
  //               -37.2188,  90.5000,  68.0625,  69.0625,  54.0312, -64.6875
  VLOAD_16(v2, 0x503e, 0x4fef, 0xd300, 0xd3c2, 0x54db, 0xc7bd, 0xd4b6, 0x4432, 0x54f9, 0xd576, 0xd0a7, 0x55a8, 0x5441,
           0x5451, 0x52c1, 0xd40b);
  //              -92.3125, -75.9375,  26.1094,
  //              -79.6875,  3.9375,  37.2812,  50.7812, -3.9375, -55.9688,
  //              -31.5312,  76.0000,  69.1875, -8.2578, -52.5000,
  //              -98.4375,  40.3438
  VLOAD_16(v6, 0xd5c5, 0xd4bf, 0x4e87, 0xd4fb, 0x43e0, 0x50a9, 0x5259, 0xc3e0, 0xd2ff, 0xcfe2, 0x54c0, 0x5453, 0xc821,
           0xd290, 0xd627, 0x510b);
  //               75.62483215,  29.19676971,  69.45310211, -70.36167145,
  //               -0.92180759, -77.84928131,  86.66299438, -43.34124756,
  //               -3.36894345,  7.33576536, -64.43717194, -80.48993683,
  //               -5.57641745,  89.34833527, -39.19780731, -55.64332581
  VLOAD_32(v4, 0x42973fea, 0x41e992fc, 0x428ae7fd, 0xc28cb92d, 0xbf6bfb95, 0xc29bb2d5, 0x42ad5374, 0xc22d5d70,
           0xc0579cc5, 0x40eabe97, 0xc280dfd5, 0xc2a0fad9, 0xc0b27203, 0x42b2b259, 0xc21cca8e, 0xc25e92c4);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vfwnmacc.vv v4, v2, v6, v0.t");
  //               75.62483215,  2380.63232422,  69.45310211, -4875.24365234,
  //               -0.92180759,  366.34207153,  86.66299438,  59.86029053,
  //               -3.36894345, -2762.37866211, -64.43717194, -6180.97900391,
  //               -5.57641745,  3536.43286133, -39.19780731,  2665.37963867
  VCMP_U32(2, v4, 0x42973fea, 0x4514ca1e, 0x428ae7fd, 0xc59859f3, 0xbf6bfb95, 0x43b72bc9, 0x42ad5374, 0x426f70f0,
           0xc0579cc5, 0xc52ca60f, 0xc280dfd5, 0xc5c127d5, 0xc0b27203, 0x455d06ed, 0xc21cca8e, 0x45269613);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  float fscalar_16;
  //               85.2500, -7.6602, -81.8125, -37.2500,
  //               -48.0000,  14.9531,  25.9844,  96.1875,  46.5000,
  //               -77.4375,  45.5312, -68.7500,  58.8438, -70.5625, -45.9375,
  //               -90.5000
  VLOAD_16(v2, 0x5554, 0xc7a9, 0xd51d, 0xd0a8, 0xd200, 0x4b7a, 0x4e7f, 0x5603, 0x51d0, 0xd4d7, 0x51b1, 0xd44c, 0x535b,
           0xd469, 0xd1be, 0xd5a8);
  //               6.19335365, -81.26284790,
  //               -77.74858093,  15.38204670,  27.37081337,  48.81098938,
  //               -82.18785095,  3.87765026, -34.03960037,
  //               -92.34690857,  46.98464203,  28.09385681,  58.44809723,  57.04935455,
  //               -44.62148285,  83.52678680
  VLOAD_32(v4, 0x40c62ff4, 0xc2a28694, 0xc29b7f46, 0x41761cdd, 0x41daf76d, 0x42433e74, 0xc2a4602e, 0x40782b6c,
           0xc208288d, 0xc2b8b19e, 0x423bf046, 0x41e0c038, 0x4269cada, 0x4264328a, 0xc2327c66, 0x42a70db7);
  //                             -47.9375
  BOX_HALF_IN_FLOAT(fscalar_16, 0xd1fe);
  asm volatile("vfwnmacc.vf v4, %[A], v2" ::[A] "f"(fscalar_16));
  //               4080.47851562, -285.94589233, -3844.13818359, -1801.05395508,
  //               -2328.37084961,  668.00445557,  1327.81384277, 4607.11083984,
  //               2263.13330078, -3619.81323242,  2135.66967773,
  //               -3323.79687500,  2762.37426758, -3439.63916016,
  //               -2157.50732422, -4421.87060547
  VCMP_U32(3, v4, 0x457f07a8, 0xc38ef913, 0xc5704236, 0xc4e121ba, 0xc51185ef, 0x44270049, 0x44a5fa0b, 0x458ff8e3,
           0x450d7222, 0xc5623d03, 0x45057ab7, 0xc54fbcc0, 0x452ca5fd, 0xc556fa3a, 0xc506d81e, 0xc58a2ef7);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                85.2500, -7.6602, -81.8125, -37.2500,
  //                -48.0000,  14.9531,  25.9844,  96.1875,  46.5000,
  //                -77.4375,  45.5312, -68.7500,  58.8438, -70.5625, -45.9375,
  //                -90.5000
  VLOAD_16(v2, 0x5554, 0xc7a9, 0xd51d, 0xd0a8, 0xd200, 0x4b7a, 0x4e7f, 0x5603, 0x51d0, 0xd4d7, 0x51b1, 0xd44c, 0x535b,
           0xd469, 0xd1be, 0xd5a8);
  //                6.19335365, -81.26284790,
  //                -77.74858093,  15.38204670,  27.37081337,  48.81098938,
  //                -82.18785095,  3.87765026, -34.03960037,
  //                -92.34690857,  46.98464203,  28.09385681,  58.44809723,  57.04935455,
  //                -44.62148285,  83.52678680
  VLOAD_32(v4, 0x40c62ff4, 0xc2a28694, 0xc29b7f46, 0x41761cdd, 0x41daf76d, 0x42433e74, 0xc2a4602e, 0x40782b6c,
           0xc208288d, 0xc2b8b19e, 0x423bf046, 0x41e0c038, 0x4269cada, 0x4264328a, 0xc2327c66, 0x42a70db7);
  VLOAD_8(v0, 0xAA, 0xAA);
  //                             -47.9375
  BOX_HALF_IN_FLOAT(fscalar_16, 0xd1fe);
  asm volatile("vfwnmacc.vf v4, %[A], v2, v0.t" ::[A] "f"(fscalar_16));
  //                6.19335365, -285.94589233, -77.74858093,
  //                -1801.05395508,  27.37081337,  668.00445557, -82.18785095,
  //                4607.11083984, -34.03960037, -3619.81323242,  46.98464203,
  //                -3323.79687500,  58.44809723, -3439.63916016, -44.62148285,
  //                -4421.87060547
  VCMP_U32(4, v4, 0x40c62ff4, 0xc38ef913, 0xc29b7f46, 0xc4e121ba, 0x41daf76d, 0x44270049, 0xc2a4602e, 0x458ff8e3,
           0xc208288d, 0xc5623d03, 0x423bf046, 0xc54fbcc0, 0x4269cada, 0xc556fa3a, 0xc2327c66, 0xc58a2ef7);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
