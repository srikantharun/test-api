// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>
//         Matteo Perotti <mperotti@iis.ee.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //              -27.1719,  16.3438, -76.1250,  73.7500,  39.2500,  32.8438,
  //              -48.0312, -62.9062, -52.3125,  50.8750, -32.1562, -86.3750,
  //              -42.7812,  97.2500, -83.6250,  46.6250
  VLOAD_16(v2, 0xcecb, 0x4c16, 0xd4c2, 0x549c, 0x50e8, 0x501b, 0xd201, 0xd3dd, 0xd28a, 0x525c, 0xd005, 0xd566, 0xd159,
           0x5614, 0xd53a, 0x51d4);
  //              -18.1719, -46.5312, -72.7500,
  //              -78.0625,  13.7344,  6.3164,  19.1250,  23.3125,  72.4375,
  //              -53.2812, -16.3438, -95.0625, -96.2500,  10.4141,
  //              -44.4688,  42.5938
  VLOAD_16(v6, 0xcc8b, 0xd1d1, 0xd48c, 0xd4e1, 0x4ade, 0x4651, 0x4cc8, 0x4dd4, 0x5487, 0xd2a9, 0xcc16, 0xd5f1, 0xd604,
           0x4935, 0xd18f, 0x5153);
  //               69.72727966,  14.41778183,
  //               -64.82620239,  5.66590357,  73.33881378,
  //               -23.97786140,  94.91672516,  17.38204765, -39.07393646,
  //               -50.71182251, -11.98221493, -36.07648849,
  //               -86.86090088,  55.96418381,  61.43484116, -88.02533722
  VLOAD_32(v4, 0x428b745e, 0x4166af3c, 0xc281a704, 0x40b54f15, 0x4292ad79, 0xc1bfd2a9, 0x42bdd55d, 0x418b0e6f,
           0xc21c4bb6, 0xc24ad8e8, 0xc13fb727, 0xc2104e53, 0xc2adb8c8, 0x425fdb53, 0x4275bd47, 0xc2b00cf9);
  asm volatile("vfwnmsac.vv v4, v2, v6");
  //              -424.03662109,  774.91290283, -5602.91992188,  5762.77539062,
  //              -465.73541260, -231.43232727,  1013.51440430,  1483.88403320,
  //              3750.31274414,  2659.97167969, -537.53594971, -8247.09960938,
  //              -4204.55615234, -956.80340576, -3657.26440430, -2073.95898438
  VCMP_U32(1, v4, 0xc3d404b0, 0x4441ba6d, 0xc5af175c, 0x45b41634, 0xc3e8de22, 0xc3676ead, 0x447d60ec, 0x44b97c4a,
           0x456a6501, 0x45263f8c, 0xc406624d, 0xc600dc66, 0xc5836473, 0xc46f336b, 0xc564943b, 0xc5019f58);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //              -27.1719,  16.3438, -76.1250,  73.7500,  39.2500,  32.8438,
  //              -48.0312, -62.9062, -52.3125,  50.8750, -32.1562, -86.3750,
  //              -42.7812,  97.2500, -83.6250,  46.6250
  VLOAD_16(v2, 0xcecb, 0x4c16, 0xd4c2, 0x549c, 0x50e8, 0x501b, 0xd201, 0xd3dd, 0xd28a, 0x525c, 0xd005, 0xd566, 0xd159,
           0x5614, 0xd53a, 0x51d4);
  //              -18.1719, -46.5312, -72.7500,
  //              -78.0625,  13.7344,  6.3164,  19.1250,  23.3125,  72.4375,
  //              -53.2812, -16.3438, -95.0625, -96.2500,  10.4141,
  //              -44.4688,  42.5938
  VLOAD_16(v6, 0xcc8b, 0xd1d1, 0xd48c, 0xd4e1, 0x4ade, 0x4651, 0x4cc8, 0x4dd4, 0x5487, 0xd2a9, 0xcc16, 0xd5f1, 0xd604,
           0x4935, 0xd18f, 0x5153);
  //               69.72727966,  14.41778183,
  //               -64.82620239,  5.66590357,  73.33881378,
  //               -23.97786140,  94.91672516,  17.38204765, -39.07393646,
  //               -50.71182251, -11.98221493, -36.07648849,
  //               -86.86090088,  55.96418381,  61.43484116, -88.02533722
  VLOAD_32(v4, 0x428b745e, 0x4166af3c, 0xc281a704, 0x40b54f15, 0x4292ad79, 0xc1bfd2a9, 0x42bdd55d, 0x418b0e6f,
           0xc21c4bb6, 0xc24ad8e8, 0xc13fb727, 0xc2104e53, 0xc2adb8c8, 0x425fdb53, 0x4275bd47, 0xc2b00cf9);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vfwnmsac.vv v4, v2, v6, v0.t");
  //               69.72727966,  774.91290283, -64.82620239,
  //               5762.77539062,  73.33881378, -231.43232727,  94.91672516,
  //               1483.88403320, -39.07393646,  2659.97167969, -11.98221493,
  //               -8247.09960938, -86.86090088, -956.80340576,  61.43484116,
  //               -2073.95898438
  VCMP_U32(2, v4, 0x428b745e, 0x4441ba6d, 0xc281a704, 0x45b41634, 0x4292ad79, 0xc3676ead, 0x42bdd55d, 0x44b97c4a,
           0xc21c4bb6, 0x45263f8c, 0xc13fb727, 0xc600dc66, 0xc2adb8c8, 0xc46f336b, 0x4275bd47, 0xc5019f58);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //               15.1797, -57.5312, -39.9688,  95.8125,  22.3906,
  //               -30.2344,  61.3438,  67.1250, -80.6250, -20.6875, -34.1250,
  //               -7.6758, -25.1562,  64.8125,  28.0156, -51.9688
  VLOAD_16(v2, 0x4b97, 0xd331, 0xd0ff, 0x55fd, 0x4d99, 0xcf8f, 0x53ab, 0x5432, 0xd50a, 0xcd2c, 0xd044, 0xc7ad, 0xce4a,
           0x540d, 0x4f01, 0xd27f);
  //              -90.47762299, -89.97399139, -34.20752716,
  //              -93.73470306,  81.75606537,  80.60296631,  73.45400238,
  //              -61.63031769, -55.39078903,  21.99703789,  29.49930191,
  //              -64.56553650, -17.54965782,  84.51310730, -88.96613312,
  //              -6.75917578
  VLOAD_32(v4, 0xc2b4f48b, 0xc2b3f2af, 0xc208d482, 0xc2bb782b, 0x42a3831b, 0x42a134b8, 0x4292e873, 0xc2768572,
           0xc25d902b, 0x41aff9ef, 0x41ebfe92, 0xc281218e, 0xc18c65b3, 0x42a906b6, 0xc2b1eea9, 0xc0d84b2b);
  //                             -27.7344
  BOX_HALF_IN_FLOAT(fscalar_16, 0xceef);
  asm volatile("vfwnmsac.vf v4, %[A], v2" ::[A] "f"(fscalar_16));
  //               330.52151489, -1685.56726074, -1142.71582031,  2563.56518555,
  //               702.74603271, -757.92852783,  1774.78454590,  1800.03955078,
  //               -2291.47485352, -551.75787354, -916.93621826, -277.44854736,
  //               -715.24255371,  1882.04724121,  688.02972412, -1448.07995605
  VCMP_U32(3, v4, 0x43a542c1, 0xc4d2b227, 0xc48ed6e8, 0x4520390b, 0x442fafbf, 0xc43d7b6d, 0x44ddd91b, 0x44e10144,
           0xc50f3799, 0xc409f081, 0xc4653beb, 0xc38ab96a, 0xc432cf86, 0x44eb4183, 0x442c01e7, 0xc4b5028f);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                15.1797, -57.5312, -39.9688,  95.8125,  22.3906,
  //                -30.2344,  61.3438,  67.1250, -80.6250, -20.6875, -34.1250,
  //                -7.6758, -25.1562,  64.8125,  28.0156, -51.9688
  VLOAD_16(v2, 0x4b97, 0xd331, 0xd0ff, 0x55fd, 0x4d99, 0xcf8f, 0x53ab, 0x5432, 0xd50a, 0xcd2c, 0xd044, 0xc7ad, 0xce4a,
           0x540d, 0x4f01, 0xd27f);
  //               -90.47762299, -89.97399139, -34.20752716,
  //               -93.73470306,  81.75606537,  80.60296631,  73.45400238,
  //               -61.63031769, -55.39078903,  21.99703789,  29.49930191,
  //               -64.56553650, -17.54965782,  84.51310730, -88.96613312,
  //               -6.75917578
  VLOAD_32(v4, 0xc2b4f48b, 0xc2b3f2af, 0xc208d482, 0xc2bb782b, 0x42a3831b, 0x42a134b8, 0x4292e873, 0xc2768572,
           0xc25d902b, 0x41aff9ef, 0x41ebfe92, 0xc281218e, 0xc18c65b3, 0x42a906b6, 0xc2b1eea9, 0xc0d84b2b);
  VLOAD_8(v0, 0xAA, 0xAA);
  //                             -27.7344
  BOX_HALF_IN_FLOAT(fscalar_16, 0xceef);
  asm volatile("vfwnmsac.vf v4, %[A], v2, v0.t" ::[A] "f"(fscalar_16));
  //               -90.47762299, -1685.56726074, -34.20752716,
  //               2563.56518555,  81.75606537, -757.92852783,  73.45400238,
  //               1800.03955078, -55.39078903, -551.75787354,  29.49930191,
  //               -277.44854736, -17.54965782,  1882.04724121, -88.96613312,
  //               -1448.07995605
  VCMP_U32(4, v4, 0xc2b4f48b, 0xc4d2b227, 0xc208d482, 0x4520390b, 0x42a3831b, 0xc43d7b6d, 0x4292e873, 0x44e10144,
           0xc25d902b, 0xc409f081, 0x41ebfe92, 0xc38ab96a, 0xc18c65b3, 0x44eb4183, 0xc2b1eea9, 0xc4b5028f);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
