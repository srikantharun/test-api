// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matteo Perotti <mperotti@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //              -0.0091, -0.3794, -0.0005, -0.0464,  0.4834,  0.2932, -0.3042,
  //              -0.3096, -0.9844, -0.1815, -0.8760,  0.0853, -0.3723, -0.8877,
  //              0.1584,  0.1943
  VLOAD_16(v2, 0xa0ac, 0xb612, 0x8f83, 0xa9f0, 0x37bc, 0x34b1, 0xb4de, 0xb4f4, 0xbbe0, 0xb1cf, 0xbb02, 0x2d75, 0xb5f5,
           0xbb1a, 0x3112, 0x3238);
  //              -0.3301,  0.7769,  0.6572, -0.8193,  0.4529,  0.2349,  0.5264,
  //              -0.2456,  0.0873,  0.5381,  0.4670,  0.8564, -0.1790,  0.6641,
  //              0.0182,  0.0447
  VLOAD_16(v3, 0xb548, 0x3a37, 0x3942, 0xba8e, 0x373f, 0x3384, 0x3836, 0xb3dc, 0x2d97, 0x384e, 0x3779, 0x3ada, 0xb1ba,
           0x3950, 0x24a7, 0x29b9);
  //               0.5835,  0.4404, -0.3459,  0.0516, -0.4866, -0.2191,  0.0685,
  //               -0.5430, -0.1429, -0.7539, -0.6416, -0.6758, -0.1147, 0.3438,
  //               0.3440,  0.1991
  VLOAD_16(v1, 0x38ab, 0x370c, 0xb589, 0x2a9b, 0xb7c9, 0xb303, 0x2c62, 0xb858, 0xb093, 0xba08, 0xb922, 0xb968, 0xaf57,
           0x3580, 0x3581, 0x325f);
  asm volatile("vfnmsub.vv v1, v2, v3");
  //              -0.3247,  0.9438,  0.6572, -0.8169,  0.6880,  0.2991,  0.5474,
  //              -0.4136, -0.0534,  0.4014, -0.0950,  0.9141, -0.2217,  0.9692,
  //              -0.0363,  0.0060
  VCMP_U16(1, v1, 0xb532, 0x3b8d, 0x3942, 0xba89, 0x3981, 0x34c9, 0x3861, 0xb69e, 0xaad5, 0x366b, 0xae14, 0x3b50,
           0xb318, 0x3bc1, 0xa8a7, 0x1e29);

  VSET(16, e32, m2);
  //               0.76259303, -0.43966120, -0.19390504, -0.57240725,
  //               -0.57148474, -0.93710214,  0.24273214,  0.44242114,
  //               -0.93160200, -0.56412256, -0.75430351, -0.02741535,
  //               -0.60542876, -0.93627954,  0.02798123,  0.23119579
  VLOAD_32(v4, 0x3f43394c, 0xbee11b46, 0xbe468f0b, 0xbf128948, 0xbf124cd3, 0xbf6fe5ed, 0x3e788ec6, 0x3ee28506,
           0xbf6e7d78, 0xbf106a56, 0xbf411a09, 0xbce09629, 0xbf1afd61, 0xbf6fb004, 0x3ce538e6, 0x3e6cbe97);
  //               0.48736989,  0.19715627, -0.47227743,  0.13752034,
  //               -0.16710435,  0.84761631,  0.37147006,  0.25389814,
  //               -0.44707820,  0.38169226, -0.82191414, -0.81056035,
  //               0.29047397, -0.46743703, -0.91869444, -0.08079135
  VLOAD_32(v6, 0x3ef9888c, 0x3e49e355, 0xbef1ce59, 0x3e0cd222, 0xbe2b1d67, 0x3f58fd62, 0x3ebe3153, 0x3e81fef0,
           0xbee4e76f, 0x3ec36d2b, 0xbf5268f7, 0xbf4f80e2, 0x3e94b901, 0xbeef53e8, 0xbf6b2f8f, 0xbda575f0);
  //              -0.48655373, -0.87417608,  0.17854533,  0.67417324,
  //              0.46947387,  0.29113689, -0.11920074,  0.63394654,
  //              -0.82611400, -0.84088647, -0.13328743,  0.29885510,
  //              0.91797447, -0.15480036,  0.76857966,  0.16230854
  VLOAD_32(v2, 0xbef91d92, 0xbf5fca01, 0x3e36d496, 0x3f2c969e, 0x3ef05ee1, 0x3e950fe5, 0xbdf41f84, 0x3f224a52,
           0xbf537c35, 0xbf574456, 0xbe087c80, 0x3e990389, 0x3f6b0060, 0xbe1e83fc, 0x3f44c1a3, 0x3e263436);
  asm volatile("vfnmsub.vv v2, v4, v6");
  //               0.85841238, -0.18718503, -0.43765658,  0.52342200,
  //               0.10119282,  1.12044132,  0.40040392, -0.02657321,
  //               -1.21668768, -0.09267077, -0.92245328, -0.80236715,
  //               0.84624207, -0.61237341, -0.94020027, -0.11831641
  VCMP_U32(2, v2, 0x3f5bc0ea, 0xbe3fad70, 0xbee01486, 0x3f05fefc, 0x3dcf3e2c, 0x3f8f6a9f, 0x3ecd01be, 0xbcd9b00d,
           0xbf9bbc6c, 0xbdbdca2c, 0xbf6c25e6, 0xbf4d67ef, 0x3f58a353, 0xbf1cc481, 0xbf70b0f7, 0xbdf24fdf);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //              -0.0091, -0.3794, -0.0005, -0.0464,  0.4834,  0.2932, -0.3042,
  //              -0.3096, -0.9844, -0.1815, -0.8760,  0.0853, -0.3723, -0.8877,
  //              0.1584,  0.1943
  VLOAD_16(v2, 0xa0ac, 0xb612, 0x8f83, 0xa9f0, 0x37bc, 0x34b1, 0xb4de, 0xb4f4, 0xbbe0, 0xb1cf, 0xbb02, 0x2d75, 0xb5f5,
           0xbb1a, 0x3112, 0x3238);
  //              -0.3301,  0.7769,  0.6572, -0.8193,  0.4529,  0.2349,  0.5264,
  //              -0.2456,  0.0873,  0.5381,  0.4670,  0.8564, -0.1790,  0.6641,
  //              0.0182,  0.0447
  VLOAD_16(v3, 0xb548, 0x3a37, 0x3942, 0xba8e, 0x373f, 0x3384, 0x3836, 0xb3dc, 0x2d97, 0x384e, 0x3779, 0x3ada, 0xb1ba,
           0x3950, 0x24a7, 0x29b9);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               0.5835,  0.4404, -0.3459,  0.0516, -0.4866, -0.2191,  0.0685,
  //               -0.5430, -0.1429, -0.7539, -0.6416, -0.6758, -0.1147, 0.3438,
  //               0.3440,  0.1991
  VLOAD_16(v1, 0x38ab, 0x370c, 0xb589, 0x2a9b, 0xb7c9, 0xb303, 0x2c62, 0xb858, 0xb093, 0xba08, 0xb922, 0xb968, 0xaf57,
           0x3580, 0x3581, 0x325f);
  asm volatile("vfnmsub.vv v1, v2, v3, v0.t");
  //               0.5835,  0.9438, -0.3459, -0.8169, -0.4866,  0.2991,  0.0685,
  //               -0.4136, -0.1429,  0.4014, -0.6416,  0.9141, -0.1147, 0.9692,
  //               0.3440,  0.0060
  VCMP_U16(4, v1, 0x38ab, 0x3b8d, 0xb589, 0xba89, 0xb7c9, 0x34c9, 0x2c62, 0xb69e, 0xb093, 0x366b, 0xb922, 0x3b50,
           0xaf57, 0x3bc1, 0x3581, 0x1e29);

  VSET(16, e32, m2);
  //               0.76259303, -0.43966120, -0.19390504, -0.57240725,
  //               -0.57148474, -0.93710214,  0.24273214,  0.44242114,
  //               -0.93160200, -0.56412256, -0.75430351, -0.02741535,
  //               -0.60542876, -0.93627954,  0.02798123,  0.23119579
  VLOAD_32(v4, 0x3f43394c, 0xbee11b46, 0xbe468f0b, 0xbf128948, 0xbf124cd3, 0xbf6fe5ed, 0x3e788ec6, 0x3ee28506,
           0xbf6e7d78, 0xbf106a56, 0xbf411a09, 0xbce09629, 0xbf1afd61, 0xbf6fb004, 0x3ce538e6, 0x3e6cbe97);
  //               0.48736989,  0.19715627, -0.47227743,  0.13752034,
  //               -0.16710435,  0.84761631,  0.37147006,  0.25389814,
  //               -0.44707820,  0.38169226, -0.82191414, -0.81056035,
  //               0.29047397, -0.46743703, -0.91869444, -0.08079135
  VLOAD_32(v6, 0x3ef9888c, 0x3e49e355, 0xbef1ce59, 0x3e0cd222, 0xbe2b1d67, 0x3f58fd62, 0x3ebe3153, 0x3e81fef0,
           0xbee4e76f, 0x3ec36d2b, 0xbf5268f7, 0xbf4f80e2, 0x3e94b901, 0xbeef53e8, 0xbf6b2f8f, 0xbda575f0);
  VLOAD_8(v0, 0xAA, 0xAA);
  //              -0.48655373, -0.87417608,  0.17854533,  0.67417324,
  //              0.46947387,  0.29113689, -0.11920074,  0.63394654,
  //              -0.82611400, -0.84088647, -0.13328743,  0.29885510,
  //              0.91797447, -0.15480036,  0.76857966,  0.16230854
  VLOAD_32(v2, 0xbef91d92, 0xbf5fca01, 0x3e36d496, 0x3f2c969e, 0x3ef05ee1, 0x3e950fe5, 0xbdf41f84, 0x3f224a52,
           0xbf537c35, 0xbf574456, 0xbe087c80, 0x3e990389, 0x3f6b0060, 0xbe1e83fc, 0x3f44c1a3, 0x3e263436);
  asm volatile("vfnmsub.vv v2, v4, v6, v0.t");
  //              -0.48655373, -0.18718503,  0.17854533,  0.52342200,
  //              0.46947387,  1.12044132, -0.11920074, -0.02657321,
  //              -0.82611400, -0.09267077, -0.13328743, -0.80236715,
  //              0.91797447, -0.61237341,  0.76857966, -0.11831641
  VCMP_U32(5, v2, 0xbef91d92, 0xbe3fad70, 0x3e36d496, 0x3f05fefc, 0x3ef05ee1, 0x3f8f6a9f, 0xbdf41f84, 0xbcd9b00d,
           0xbf537c35, 0xbdbdca2c, 0xbe087c80, 0xbf4d67ef, 0x3f6b0060, 0xbf1cc481, 0x3f44c1a3, 0xbdf24fdf);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                             -0.1346
  BOX_HALF_IN_FLOAT(fscalar_16, 0xb04f);
  //              -0.1886,  0.9912, -0.0325,  0.5850,  0.2578, -0.2350, -0.8701,
  //              0.9209,  0.5859, -0.4795,  0.8682,  0.9233, -0.8896, -0.5981,
  //              -0.3223,  0.6924
  VLOAD_16(v2, 0xb209, 0x3bee, 0xa82a, 0x38ae, 0x3420, 0xb385, 0xbaf6, 0x3b5e, 0x38b0, 0xb7ac, 0x3af2, 0x3b63, 0xbb1e,
           0xb8c9, 0xb528, 0x398a);
  //              -0.0126,  0.9678,  0.8945, -0.9600, -0.9272,  0.4412,  0.5527,
  //              0.1136,  0.7207, -0.5181, -0.2810, -0.4048,  0.1648,  0.7612,
  //              -0.8853,  0.1761
  VLOAD_16(v1, 0xa27a, 0x3bbe, 0x3b28, 0xbbae, 0xbb6b, 0x370f, 0x386c, 0x2f45, 0x39c4, 0xb825, 0xb47f, 0xb67a, 0x3146,
           0x3a17, 0xbb15, 0x31a3);
  asm volatile("vfnmsub.vf v1, %[A], v2" ::[A] "f"(fscalar_16));
  //              -0.1903,  1.1211,  0.0879,  0.4556,  0.1329, -0.1755, -0.7959,
  //              0.9360,  0.6831, -0.5493,  0.8301,  0.8687, -0.8677, -0.4956,
  //              -0.4414,  0.7163
  VCMP_U16(7, v1, 0xb217, 0x3c7c, 0x2da0, 0x374b, 0x3041, 0xb19e, 0xba5e, 0x3b7d, 0x3977, 0xb865, 0x3aa5, 0x3af3,
           0xbaf1, 0xb7ee, 0xb710, 0x39bb);

  VSET(16, e32, m2);
  float fscalar_32;
  //                              -0.16110219
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0xbe24f7f9);
  //              -0.31537205, -0.17563045, -0.79069936,  0.22939304,
  //              -0.89379781,  0.26157290,  0.56702632, -0.11594663,
  //              0.09605245,  0.45930776, -0.76518077, -0.26341528, 0.74385208,
  //              0.89362013, -0.21185355,  0.23924881
  VLOAD_32(v4, 0xbea17872, 0xbe33d878, 0xbf4a6b46, 0x3e6ae602, 0xbf64cfef, 0x3e85ece2, 0x3f1128a3, 0xbded756d,
           0x3dc4b726, 0x3eeb2a63, 0xbf43e2e3, 0xbe86de5e, 0x3f3e6d17, 0x3f64c44a, 0xbe58f023, 0x3e74fda4);
  //               0.31856158,  0.48641542,  0.57264513,  0.30210373,
  //               -0.19719712,  0.85649359,  0.36901370, -0.78377151,
  //               0.22567192, -0.75179213, -0.65690833,  0.11298654,
  //               -0.64884853, -0.48376039, -0.11539485, -0.42667609
  VLOAD_32(v2, 0x3ea31a81, 0x3ef90b71, 0x3f1298df, 0x3e9aad57, 0xbe49ee0b, 0x3f5b432a, 0x3ebcef5d, 0xbf48a540,
           0x3e67168a, 0xbf407573, 0xbf282b25, 0x3de7657d, 0xbf261af0, 0xbef7af71, 0xbdec5422, 0xbeda754a);
  asm volatile("vfnmsub.vf v2, %[A], v4" ::[A] "f"(fscalar_32));
  //              -0.26405108, -0.09726786, -0.69844496,  0.27806261,
  //              -0.92556667,  0.39955589,  0.62647521, -0.24221393,
  //              0.13240869,  0.33819240, -0.87101012, -0.24521290, 0.63932115,
  //              0.81568527, -0.23044391,  0.17051035
  VCMP_U32(8, v2, 0xbe8731b4, 0xbdc7345f, 0xbf32cd4a, 0x3e8e5e39, 0xbf6cf1f1, 0x3ecc9297, 0x3f2060ae, 0xbe7806ee,
           0x3e079625, 0x3ead278e, 0xbf5efa85, 0xbe7b1917, 0x3f23aa8d, 0x3f50d0c0, 0xbe6bf97d, 0x3e2e9a44);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                             -0.1346
  BOX_HALF_IN_FLOAT(fscalar_16, 0xb04f);
  //               -0.1886,  0.9912, -0.0325,  0.5850,  0.2578, -0.2350,
  //               -0.8701,  0.9209,  0.5859, -0.4795,  0.8682,  0.9233,
  //               -0.8896, -0.5981, -0.3223,  0.6924
  VLOAD_16(v2, 0xb209, 0x3bee, 0xa82a, 0x38ae, 0x3420, 0xb385, 0xbaf6, 0x3b5e, 0x38b0, 0xb7ac, 0x3af2, 0x3b63, 0xbb1e,
           0xb8c9, 0xb528, 0x398a);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               -0.0126,  0.9678,  0.8945, -0.9600, -0.9272,  0.4412, 0.5527,
  //               0.1136,  0.7207, -0.5181, -0.2810, -0.4048,  0.1648,  0.7612,
  //               -0.8853,  0.1761
  VLOAD_16(v1, 0xa27a, 0x3bbe, 0x3b28, 0xbbae, 0xbb6b, 0x370f, 0x386c, 0x2f45, 0x39c4, 0xb825, 0xb47f, 0xb67a, 0x3146,
           0x3a17, 0xbb15, 0x31a3);
  asm volatile("vfnmsub.vf v1, %[A], v2, v0.t" ::[A] "f"(fscalar_16));
  //               -0.0126,  1.1211,  0.8945,  0.4556, -0.9272, -0.1755, 0.5527,
  //               0.9360,  0.7207, -0.5493, -0.2810,  0.8687,  0.1648, -0.4956,
  //               -0.8853,  0.7163
  VCMP_U16(10, v1, 0xa27a, 0x3c7c, 0x3b28, 0x374b, 0xbb6b, 0xb19e, 0x386c, 0x3b7d, 0x39c4, 0xb865, 0xb47f, 0x3af3,
           0x3146, 0xb7ee, 0xbb15, 0x39bb);

  VSET(16, e32, m2);
  float fscalar_32;
  //                              -0.16110219
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0xbe24f7f9);
  //               -0.31537205, -0.17563045, -0.79069936,  0.22939304,
  //               -0.89379781,  0.26157290,  0.56702632, -0.11594663,
  //               0.09605245,  0.45930776, -0.76518077, -0.26341528,
  //               0.74385208,  0.89362013, -0.21185355,  0.23924881
  VLOAD_32(v4, 0xbea17872, 0xbe33d878, 0xbf4a6b46, 0x3e6ae602, 0xbf64cfef, 0x3e85ece2, 0x3f1128a3, 0xbded756d,
           0x3dc4b726, 0x3eeb2a63, 0xbf43e2e3, 0xbe86de5e, 0x3f3e6d17, 0x3f64c44a, 0xbe58f023, 0x3e74fda4);
  VLOAD_8(v0, 0xAA, 0xAA);
  //                0.31856158,  0.48641542,  0.57264513,  0.30210373,
  //                -0.19719712,  0.85649359,  0.36901370, -0.78377151,
  //                0.22567192, -0.75179213, -0.65690833,  0.11298654,
  //                -0.64884853, -0.48376039, -0.11539485, -0.42667609
  VLOAD_32(v2, 0x3ea31a81, 0x3ef90b71, 0x3f1298df, 0x3e9aad57, 0xbe49ee0b, 0x3f5b432a, 0x3ebcef5d, 0xbf48a540,
           0x3e67168a, 0xbf407573, 0xbf282b25, 0x3de7657d, 0xbf261af0, 0xbef7af71, 0xbdec5422, 0xbeda754a);
  asm volatile("vfnmsub.vf v2, %[A], v4, v0.t" ::[A] "f"(fscalar_32));
  //                0.31856158, -0.09726786,  0.57264513,  0.27806261,
  //                -0.19719712,  0.39955589,  0.36901370, -0.24221393,
  //                0.22567192,  0.33819240, -0.65690833, -0.24521290,
  //                -0.64884853,  0.81568527, -0.11539485,  0.17051035
  VCMP_U32(11, v2, 0x3ea31a81, 0xbdc7345f, 0x3f1298df, 0x3e8e5e39, 0xbe49ee0b, 0x3ecc9297, 0x3ebcef5d, 0xbe7806ee,
           0x3e67168a, 0x3ead278e, 0xbf282b25, 0xbe7b1917, 0xbf261af0, 0x3f50d0c0, 0xbdec5422, 0x3e2e9a44);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
