// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>

#include "vector_macros.h"

void TEST_CASE1() {
  VSET(16, e16, m1);
  VLOAD_16(v6, 0x30dc, 0x7235, 0xd5f6, 0xa008, 0x6e79, 0xa159, 0xa05c, 0x5914, 0xd06f, 0x69c5, 0x9475, 0x5625, 0xa5bd,
           0x7be7, 0x823c, 0x5fb2);
  VSET(16, e8, m1);
  VLOAD_8(v2, 0xb6, 0xbb, 0xb6, 0x57, 0xf9, 0x7c, 0xbf, 0x62, 0x1a, 0xeb, 0xa4, 0x34, 0xde, 0x96, 0x80, 0xe6);
  VLOAD_8(v4, 0x26, 0xea, 0xe8, 0x85, 0x2e, 0xf1, 0x46, 0x8f, 0x68, 0x29, 0xbb, 0x9b, 0xec, 0x5c, 0x8e, 0x77);
  asm volatile("vwmaccsu.vv v6, v2, v4");
  VSET(16, e16, m1);
  VCMP_I16(1, v6, 0x25e0, 0x3323, 0x92e6, 0xcd3b, 0x6d37, 0x1615, 0x8e96, 0x8fd2, 0xdaff, 0x6668, 0x5141, 0x75a1,
           0x8665, 0x55cf, 0x3b3c, 0x539c);

  VSET(16, e32, m2);
  VLOAD_32(v6, 0xdbc5b23d, 0x86bd7dad, 0xb744b5c2, 0xc32f4a47, 0x237edfc4, 0x5d6e851a, 0xbd3110cd, 0x18c61b57,
           0x7ade2943, 0x7e4f5ed6, 0x90e5ba77, 0xce45b744, 0x82d1976e, 0xa88bb4e1, 0x989fbb9a, 0xab29da17);
  VSET(16, e16, m1);
  VLOAD_16(v2, 0x23fb, 0xcee7, 0xa704, 0xc00f, 0xed9f, 0x2cf0, 0x4b53, 0xc0ba, 0x775b, 0x557c, 0x57b7, 0xbb06, 0xf9ba,
           0x178f, 0xec73, 0x8240);
  VLOAD_16(v4, 0xad9d, 0x104d, 0xdc56, 0x96af, 0x8c68, 0x1d25, 0x2d70, 0x467a, 0xc27c, 0x96e2, 0x1c85, 0xe8b6, 0xf7e0,
           0xd069, 0x0bca, 0x4f36);
  asm volatile("vwmaccsu.vv v6, v2, v4");
  VSET(16, e32, m2);
  VCMP_I32(2, v6, 0xf42c622c, 0x839d2928, 0x6aae411a, 0x9d8c5e88, 0x196a5c5c, 0x628c33ca, 0xca8f9c1d, 0x075acffb,
           0xd58aef57, 0xb0b17e4e, 0x9aab508a, 0x8f921d88, 0x7cbe902e, 0xbbb98e88, 0x97b93f58, 0x84411397);
}

void TEST_CASE2() {
  VSET(16, e16, m1);
  VLOAD_16(v6, 0x30dc, 0x7235, 0xd5f6, 0xa008, 0x6e79, 0xa159, 0xa05c, 0x5914, 0xd06f, 0x69c5, 0x9475, 0x5625, 0xa5bd,
           0x7be7, 0x823c, 0x5fb2);
  VSET(16, e8, m1);
  VLOAD_8(v2, 0xb6, 0xbb, 0xb6, 0x57, 0xf9, 0x7c, 0xbf, 0x62, 0x1a, 0xeb, 0xa4, 0x34, 0xde, 0x96, 0x80, 0xe6);
  VLOAD_8(v4, 0x26, 0xea, 0xe8, 0x85, 0x2e, 0xf1, 0x46, 0x8f, 0x68, 0x29, 0xbb, 0x9b, 0xec, 0x5c, 0x8e, 0x77);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vwmaccsu.vv v6, v2, v4, v0.t");
  VSET(16, e16, m1);
  VCMP_I16(4, v6, 0x30dc, 0x3323, 0xd5f6, 0xcd3b, 0x6e79, 0x1615, 0xa05c, 0x8fd2, 0xd06f, 0x6668, 0x9475, 0x75a1,
           0xa5bd, 0x55cf, 0x823c, 0x539c);

  VSET(16, e32, m2);
  VLOAD_32(v6, 0xdbc5b23d, 0x86bd7dad, 0xb744b5c2, 0xc32f4a47, 0x237edfc4, 0x5d6e851a, 0xbd3110cd, 0x18c61b57,
           0x7ade2943, 0x7e4f5ed6, 0x90e5ba77, 0xce45b744, 0x82d1976e, 0xa88bb4e1, 0x989fbb9a, 0xab29da17);
  VSET(16, e16, m1);
  VLOAD_16(v2, 0x23fb, 0xcee7, 0xa704, 0xc00f, 0xed9f, 0x2cf0, 0x4b53, 0xc0ba, 0x775b, 0x557c, 0x57b7, 0xbb06, 0xf9ba,
           0x178f, 0xec73, 0x8240);
  VLOAD_16(v4, 0xad9d, 0x104d, 0xdc56, 0x96af, 0x8c68, 0x1d25, 0x2d70, 0x467a, 0xc27c, 0x96e2, 0x1c85, 0xe8b6, 0xf7e0,
           0xd069, 0x0bca, 0x4f36);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vwmaccsu.vv v6, v2, v4, v0.t");
  VSET(16, e32, m2);
  VCMP_I32(5, v6, 0xdbc5b23d, 0x839d2928, 0xb744b5c2, 0x9d8c5e88, 0x237edfc4, 0x628c33ca, 0xbd3110cd, 0x075acffb,
           0x7ade2943, 0xb0b17e4e, 0x90e5ba77, 0x8f921d88, 0x82d1976e, 0xbbb98e88, 0x989fbb9a, 0x84411397);
}

void TEST_CASE3() {
  VSET(16, e16, m1);
  VLOAD_16(v6, 0xadd2, 0x2112, 0xbbc6, 0xd113, 0xc6f7, 0xbd07, 0xfd9a, 0x0c0e, 0xe110, 0xe81b, 0xb432, 0x5c2c, 0x4da9,
           0x8c48, 0x6f94, 0x6250);
  VSET(16, e8, m1);
  int64_t scalar = 5;
  VLOAD_8(v4, 0xfe, 0xd1, 0xc2, 0x3b, 0x79, 0x2f, 0xf5, 0xe8, 0x7f, 0x4b, 0x64, 0x57, 0x2b, 0x4f, 0x4e, 0xda);
  asm volatile("vwmaccsu.vx v6, %[A], v4" ::[A] "r"(scalar));
  VSET(16, e16, m1);
  VCMP_I16(7, v6, 0xb2c8, 0x2527, 0xbf90, 0xd23a, 0xc954, 0xbdf2, 0x0263, 0x1096, 0xe38b, 0xe992, 0xb626, 0x5ddf,
           0x4e80, 0x8dd3, 0x711a, 0x6692);

  VSET(16, e32, m2);
  VLOAD_32(v6, 0x39d3ea89, 0x451d8e1a, 0x83edb2d7, 0xc1919ab3, 0x243c3d4d, 0xd4745be8, 0x50a58cbe, 0x53b75e9f,
           0x2a648b62, 0xd74ce1cf, 0xa2c6a2e7, 0xc30eadb0, 0x7a908fb9, 0xd4455b56, 0x48109ee2, 0x2f5b537a);
  VSET(16, e16, m1);
  scalar = -5383;
  VLOAD_16(v4, 0x29f8, 0x6958, 0x6635, 0x03a0, 0x07bc, 0x4881, 0x7d4e, 0x37e3, 0x8370, 0x405f, 0x1f0d, 0x1252, 0xacf1,
           0x06ee, 0x790d, 0x73af);
  asm volatile("vwmaccsu.vx v6, %[A], v4" ::[A] "r"(scalar));
  VSET(16, e32, m2);
  VCMP_I32(8, v6, 0x36616cc1, 0x3c7674b2, 0x7b888e64, 0xc1456153, 0x23999b29, 0xce7fcb61, 0x465ab99c, 0x4f20386a,
           0x1f98c352, 0xd2035436, 0xa039b88c, 0xc18d7372, 0x6c5c1022, 0xd3b3a4d4, 0x3e1f3e87, 0x25daceb1);
}

void TEST_CASE4() {
  VSET(16, e16, m1);
  VLOAD_16(v6, 0xadd2, 0x2112, 0xbbc6, 0xd113, 0xc6f7, 0xbd07, 0xfd9a, 0x0c0e, 0xe110, 0xe81b, 0xb432, 0x5c2c, 0x4da9,
           0x8c48, 0x6f94, 0x6250);
  VSET(16, e8, m1);
  int64_t scalar = 5;
  VLOAD_8(v4, 0xfe, 0xd1, 0xc2, 0x3b, 0x79, 0x2f, 0xf5, 0xe8, 0x7f, 0x4b, 0x64, 0x57, 0x2b, 0x4f, 0x4e, 0xda);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vwmaccsu.vx v6, %[A], v4, v0.t" ::[A] "r"(scalar));
  VSET(16, e16, m1);
  VCMP_I16(10, v6, 0xadd2, 0x2527, 0xbbc6, 0xd23a, 0xc6f7, 0xbdf2, 0xfd9a, 0x1096, 0xe110, 0xe992, 0xb432, 0x5ddf,
           0x4da9, 0x8dd3, 0x6f94, 0x6692);

  VSET(16, e32, m2);
  VLOAD_32(v6, 0x39d3ea89, 0x451d8e1a, 0x83edb2d7, 0xc1919ab3, 0x243c3d4d, 0xd4745be8, 0x50a58cbe, 0x53b75e9f,
           0x2a648b62, 0xd74ce1cf, 0xa2c6a2e7, 0xc30eadb0, 0x7a908fb9, 0xd4455b56, 0x48109ee2, 0x2f5b537a);
  VSET(16, e16, m1);
  scalar = -5383;
  VLOAD_16(v4, 0x29f8, 0x6958, 0x6635, 0x03a0, 0x07bc, 0x4881, 0x7d4e, 0x37e3, 0x8370, 0x405f, 0x1f0d, 0x1252, 0xacf1,
           0x06ee, 0x790d, 0x73af);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vwmaccsu.vx v6, %[A], v4, v0.t" ::[A] "r"(scalar));
  VSET(16, e32, m2);
  VCMP_I32(11, v6, 0x39d3ea89, 0x3c7674b2, 0x83edb2d7, 0xc1456153, 0x243c3d4d, 0xce7fcb61, 0x50a58cbe, 0x4f20386a,
           0x2a648b62, 0xd2035436, 0xa2c6a2e7, 0xc18d7372, 0x7a908fb9, 0xd3b3a4d4, 0x48109ee2, 0x25daceb1);
}

int main(void) {
  INIT_CHECK();
  enable_vec();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
