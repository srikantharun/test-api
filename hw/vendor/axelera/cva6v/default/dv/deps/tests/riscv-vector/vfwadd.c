// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>
//         Matteo Perotti <mperotti@iis.ee.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //               10.5312,  79.6250,  12.2891,  89.5000,  62.5938,  53.5625,
  //               -37.3438, -48.3750,  49.3438,  1.1475, -79.6250,  52.0000,
  //               -61.0312,  5.1641,  48.7500, -25.6250
  VLOAD_16(v2, 0x4944, 0x54fa, 0x4a25, 0x5598, 0x53d3, 0x52b2, 0xd0ab, 0xd20c, 0x522b, 0x3c97, 0xd4fa, 0x5280, 0xd3a1,
           0x452a, 0x5218, 0xce68);
  //               68.1875,
  //               -7.0742,  20.2656,  72.3125,  88.5625,  36.0000,  96.6250,  70.4375,
  //               -87.6875,  87.6875,  8.7891, -18.8906, -40.1562,  88.8750,
  //               -55.5312,  2.1875
  VLOAD_16(v3, 0x5443, 0xc713, 0x4d11, 0x5485, 0x5589, 0x5080, 0x560a, 0x5467, 0xd57b, 0x557b, 0x4865, 0xccb9, 0xd105,
           0x558e, 0xd2f1, 0x4060);
  asm volatile("vfwadd.vv v4, v2, v3");
  //               78.71875000,  72.55078125,  32.55468750,  161.81250000,
  //               151.15625000,  89.56250000,  59.28125000,  22.06250000,
  //               -38.34375000,  88.83496094, -70.83593750,  33.10937500,
  //               -101.18750000,  94.03906250, -6.78125000, -23.43750000
  VSET(16, e32, m2);
  VCMP_U32(1, v4, 0x429d7000, 0x42911a00, 0x42023800, 0x4321d000, 0x43172800, 0x42b32000, 0x426d2000, 0x41b08000,
           0xc2196000, 0x42b1ab80, 0xc28dac00, 0x42047000, 0xc2ca6000, 0x42bc1400, 0xc0d90000, 0xc1bb8000);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //               10.5312,  79.6250,  12.2891,  89.5000,  62.5938,  53.5625,
  //               -37.3438, -48.3750,  49.3438,  1.1475, -79.6250,  52.0000,
  //               -61.0312,  5.1641,  48.7500, -25.6250
  VLOAD_16(v2, 0x4944, 0x54fa, 0x4a25, 0x5598, 0x53d3, 0x52b2, 0xd0ab, 0xd20c, 0x522b, 0x3c97, 0xd4fa, 0x5280, 0xd3a1,
           0x452a, 0x5218, 0xce68);
  //               68.1875,
  //               -7.0742,  20.2656,  72.3125,  88.5625,  36.0000,  96.6250,  70.4375,
  //               -87.6875,  87.6875,  8.7891, -18.8906, -40.1562,  88.8750,
  //               -55.5312,  2.1875
  VLOAD_16(v3, 0x5443, 0xc713, 0x4d11, 0x5485, 0x5589, 0x5080, 0x560a, 0x5467, 0xd57b, 0x557b, 0x4865, 0xccb9, 0xd105,
           0x558e, 0xd2f1, 0x4060);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v4);
  VCLEAR(v5);
  asm volatile("vfwadd.vv v4, v2, v3, v0.t");
  //               0.00000000,  72.55078125,  0.00000000,  161.81250000,
  //               0.00000000,  89.56250000,  0.00000000,  22.06250000,
  //               0.00000000,  88.83496094,  0.00000000,  33.10937500,
  //               0.00000000,  94.03906250,  0.00000000, -23.43750000
  VSET(16, e32, m2);
  VCMP_U32(2, v4, 0x0, 0x42911a00, 0x0, 0x4321d000, 0x0, 0x42b32000, 0x0, 0x41b08000, 0x0, 0x42b1ab80, 0x0, 0x42047000,
           0x0, 0x42bc1400, 0x0, 0xc1bb8000);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                              12.5859
  BOX_HALF_IN_FLOAT(fscalar_16, 0x4a4b);
  //               2.1094,  59.2188,  89.4375,  75.2500, -4.0742,  64.7500,
  //               -82.9375, -84.9375, -48.0625,
  //               -6.1016,  29.9688,  10.6172,  52.5938, -8.5000,  70.5000,
  //               -83.6875
  VLOAD_16(v2, 0x4038, 0x5367, 0x5597, 0x54b4, 0xc413, 0x540c, 0xd52f, 0xd54f, 0xd202, 0xc61a, 0x4f7e, 0x494f, 0x5293,
           0xc840, 0x5468, 0xd53b);
  asm volatile("vfwadd.vf v4, v2, %[A]" ::[A] "f"(fscalar_16));
  //               14.69531250,  71.80468750,
  //               102.02343750,  87.83593750,  8.51171875,  77.33593750,
  //               -70.35156250, -72.35156250,
  //               -35.47656250,  6.48437500,  42.55468750,  23.20312500,  65.17968750,
  //               4.08593750,  83.08593750, -71.10156250
  VSET(16, e32, m2);
  VCMP_U32(3, v4, 0x416b2000, 0x428f9c00, 0x42cc0c00, 0x42afac00, 0x41083000, 0x429aac00, 0xc28cb400, 0xc290b400,
           0xc20de800, 0x40cf8000, 0x422a3800, 0x41b9a000, 0x42825c00, 0x4082c000, 0x42a62c00, 0xc28e3400);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                              12.5859
  BOX_HALF_IN_FLOAT(fscalar_16, 0x4a4b);
  //                2.1094,  59.2188,  89.4375,  75.2500, -4.0742,  64.7500,
  //                -82.9375, -84.9375, -48.0625,
  //                -6.1016,  29.9688,  10.6172,  52.5938, -8.5000,  70.5000,
  //                -83.6875
  VLOAD_16(v2, 0x4038, 0x5367, 0x5597, 0x54b4, 0xc413, 0x540c, 0xd52f, 0xd54f, 0xd202, 0xc61a, 0x4f7e, 0x494f, 0x5293,
           0xc840, 0x5468, 0xd53b);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v4);
  VCLEAR(v5);
  asm volatile("vfwadd.vf v4, v2, %[A], v0.t" ::[A] "f"(fscalar_16));
  //                0.00000000,  71.80468750,  0.00000000,  87.83593750,
  //                0.00000000,  77.33593750,  0.00000000, -72.35156250,
  //                0.00000000,  6.48437500,  0.00000000,  23.20312500,
  //                0.00000000,  4.08593750,  0.00000000, -71.10156250
  VSET(16, e32, m2);
  VCMP_U32(4, v4, 0x0, 0x428f9c00, 0x0, 0x42afac00, 0x0, 0x429aac00, 0x0, 0xc290b400, 0x0, 0x40cf8000, 0x0, 0x41b9a000,
           0x0, 0x4082c000, 0x0, 0xc28e3400);
};

// Simple random test with similar values
void TEST_CASE5(void) {
  VSET(16, e16, m1);
  //              -38.1875,
  //              -22.7500,  51.3438,  8.8594,  23.0938,  32.6875,  71.7500,  7.6758,
  //              -12.8047,  98.0625, -8.7734, -73.5625,
  //              -59.0312,  44.9688,  63.8438,  30.1406
  VLOAD_16(v1, 0xd0c6, 0xcdb0, 0x526b, 0x486e, 0x4dc6, 0x5016, 0x547c, 0x47ad, 0xca67, 0x5621, 0xc863, 0xd499, 0xd361,
           0x519f, 0x53fb, 0x4f89);
  //              -4.22890615,  94.35176849, -2.66183305,  81.53971863,
  //              -30.80995941, -61.45680237,  53.70308304,  26.43629074,
  //              -50.49792862,  12.57134342, -18.77090454, -0.50017655,
  //              -33.71574402,  14.64656544,  89.57390594,  94.32437897
  VLOAD_32(v2, 0xc0875333, 0x42bcb41b, 0xc02a5b79, 0x42a31456, 0xc1f67acc, 0xc275d3c4, 0x4256cff5, 0x41d37d86,
           0xc249fde1, 0x41492439, 0xc1962ad0, 0xbf000b92, 0xc206dcec, 0x416a5855, 0x42b325d7, 0x42bca615);
  asm volatile("vfwadd.wv v4, v2, v1");
  //              -42.41640472,  71.60176849,  48.68191528,  90.39909363,
  //              -7.71620941, -28.76930237,  125.45307922,  34.11207199,
  //              -63.30261612,  110.63384247, -27.54434204, -74.06267548,
  //              -92.74699402,  59.61531448,  153.41766357,  124.46500397
  VSET(16, e32, m2);
  VCMP_U32(5, v4, 0xc229aa66, 0x428f341b, 0x4242ba48, 0x42b4cc56, 0xc0f6eb30, 0xc1e62788, 0x42fae7fa, 0x420872c3,
           0xc27d35e1, 0x42dd4487, 0xc1dc5ad0, 0xc2942017, 0xc2b97e76, 0x426e7615, 0x43196aec, 0x42f8ee15);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE6(void) {
  VSET(16, e16, m1);
  //              -38.1875,
  //              -22.7500,  51.3438,  8.8594,  23.0938,  32.6875,  71.7500,  7.6758,
  //              -12.8047,  98.0625, -8.7734, -73.5625,
  //              -59.0312,  44.9688,  63.8438,  30.1406
  VLOAD_16(v1, 0xd0c6, 0xcdb0, 0x526b, 0x486e, 0x4dc6, 0x5016, 0x547c, 0x47ad, 0xca67, 0x5621, 0xc863, 0xd499, 0xd361,
           0x519f, 0x53fb, 0x4f89);
  //              -4.22890615,  94.35176849, -2.66183305,  81.53971863,
  //              -30.80995941, -61.45680237,  53.70308304,  26.43629074,
  //              -50.49792862,  12.57134342, -18.77090454, -0.50017655,
  //              -33.71574402,  14.64656544,  89.57390594,  94.32437897
  VLOAD_32(v2, 0xc0875333, 0x42bcb41b, 0xc02a5b79, 0x42a31456, 0xc1f67acc, 0xc275d3c4, 0x4256cff5, 0x41d37d86,
           0xc249fde1, 0x41492439, 0xc1962ad0, 0xbf000b92, 0xc206dcec, 0x416a5855, 0x42b325d7, 0x42bca615);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v4);
  VCLEAR(v5);
  asm volatile("vfwadd.wv v4, v2, v1, v0.t");
  //               0.00000000,  71.60176849,  0.00000000,  90.39909363,
  //               0.00000000, -28.76930237,  0.00000000,  34.11207199,
  //               0.00000000,  110.63384247,  0.00000000, -74.06267548,
  //               0.00000000,  59.61531448,  0.00000000,  124.46500397
  VSET(16, e32, m2);
  VCMP_U32(6, v4, 0x0, 0x428f341b, 0x0, 0x42b4cc56, 0x0, 0xc1e62788, 0x0, 0x420872c3, 0x0, 0x42dd4487, 0x0, 0xc2942017,
           0x0, 0x426e7615, 0x0, 0x42f8ee15);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE7(void) {
  float fscalar_16;
  VSET(16, e16, m1);
  //              -16.64103889,  69.17821503,  38.24327850,
  //              -60.26666641,  97.95110321, -47.38455200,  94.12043762,
  //              -90.39623260, -17.02018356,  28.09982681,
  //              -85.91639709,  73.60102081, -98.61261749,
  //              -81.75864410,  40.07990265,  55.56723022
  VLOAD_32(v2, 0xc18520d9, 0x428a5b3f, 0x4218f91e, 0xc2711111, 0x42c3e6f7, 0xc23d89c8, 0x42bc3daa, 0xc2b4cadf,
           0xc1882956, 0x41e0cc72, 0xc2abd532, 0x429333b9, 0xc2c539a9, 0xc2a3846d, 0x422051d2, 0x425e44d8);
  //                              53.8750
  BOX_HALF_IN_FLOAT(fscalar_16, 0x52bc);
  asm volatile("vfwadd.wf v4, v2, %[A]" ::[A] "f"(fscalar_16));
  //               37.23396301,  123.05321503,  92.11827850, -6.39166641,
  //               151.82611084,  6.49044800,  147.99543762,
  //               -36.52123260,  36.85481644,  81.97482300, -32.04139709,
  //               127.47602081, -44.73761749, -27.88364410,  93.95490265,
  //               109.44223022
  VSET(16, e32, m2);
  VCMP_U32(7, v4, 0x4214ef94, 0x42f61b3f, 0x42b83c8f, 0xc0cc8888, 0x4317d37c, 0x40cfb1c0, 0x4313fed5, 0xc21215be,
           0x42136b55, 0x42a3f31c, 0xc2002a64, 0x42fef3b9, 0xc232f352, 0xc1df11b4, 0x42bbe8e9, 0x42dae26c);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE8(void) {
  float fscalar_16;
  VSET(16, e16, m1);
  //               -16.64103889,  69.17821503,  38.24327850,
  //               -60.26666641,  97.95110321, -47.38455200,  94.12043762,
  //               -90.39623260, -17.02018356,  28.09982681,
  //               -85.91639709,  73.60102081, -98.61261749,
  //               -81.75864410,  40.07990265,  55.56723022
  VLOAD_32(v2, 0xc18520d9, 0x428a5b3f, 0x4218f91e, 0xc2711111, 0x42c3e6f7, 0xc23d89c8, 0x42bc3daa, 0xc2b4cadf,
           0xc1882956, 0x41e0cc72, 0xc2abd532, 0x429333b9, 0xc2c539a9, 0xc2a3846d, 0x422051d2, 0x425e44d8);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v4);
  VCLEAR(v5);
  //                              53.8750
  BOX_HALF_IN_FLOAT(fscalar_16, 0x52bc);
  asm volatile("vfwadd.wf v4, v2, %[A], v0.t" ::[A] "f"(fscalar_16));
  //                0.00000000,  123.05321503,  0.00000000, -6.39166641,
  //                0.00000000,  6.49044800,  0.00000000, -36.52123260,
  //                0.00000000,  81.97482300,  0.00000000,  127.47602081,
  //                0.00000000, -27.88364410,  0.00000000,  109.44223022
  VSET(16, e32, m2);
  VCMP_U32(8, v4, 0x0, 0x42f61b3f, 0x0, 0xc0cc8888, 0x0, 0x40cfb1c0, 0x0, 0xc21215be, 0x0, 0x42a3f31c, 0x0, 0x42fef3b9,
           0x0, 0xc1df11b4, 0x0, 0x42dae26c);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  TEST_CASE5();
  MASKED_TEST(TEST_CASE6());
  TEST_CASE7();
  MASKED_TEST(TEST_CASE8());

  EXIT_CHECK();
}
