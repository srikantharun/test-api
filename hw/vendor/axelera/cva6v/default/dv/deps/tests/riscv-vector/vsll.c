// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>

#include "vector_macros.h"

void TEST_CASE1(void) {
  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01);
  VLOAD_8(v3, 0, 1, 2, 3, 7, 15, 31, 32, 0, 1, 2, 3, 7, 15, 31, 32);
  asm volatile("vsll.vv v4, v2, v3");
  VCMP_U8(1, v4, 0x01, 0x02, 0x04, 0x08, 0x80, 0x80, 0x80, 0x01, 0x01, 0x02, 0x04, 0x08, 0x80, 0x80, 0x80, 0x01);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
           0x0001, 0x0001, 0x0001);
  VLOAD_16(v3, 0, 1, 2, 3, 7, 15, 31, 32, 0, 1, 2, 3, 7, 15, 31, 32);
  asm volatile("vsll.vv v4, v2, v3");
  VCMP_U16(2, v4, 0x0001, 0x0002, 0x0004, 0x0008, 0x0080, 0x8000, 0x8000, 0x0001, 0x0001, 0x0002, 0x0004, 0x0008,
           0x0080, 0x8000, 0x8000, 0x0001);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001,
           0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001);
  VLOAD_32(v6, 0, 1, 2, 3, 7, 15, 31, 32, 0, 1, 2, 3, 7, 15, 31, 32);
  asm volatile("vsll.vv v8, v4, v6");
  VCMP_U32(3, v8, 0x00000001, 0x00000002, 0x00000004, 0x00000008, 0x00000080, 0x00008000, 0x80000000, 0x00000001,
           0x00000001, 0x00000002, 0x00000004, 0x00000008, 0x00000080, 0x00008000, 0x80000000, 0x00000001);
};

void TEST_CASE2(void) {
  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01);
  VLOAD_8(v3, 0, 1, 2, 3, 7, 15, 31, 32, 0, 1, 2, 3, 7, 15, 31, 32);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v4);
  asm volatile("vsll.vv v4, v2, v3, v0.t");
  VCMP_U8(5, v4, 0x00, 0x02, 0x00, 0x08, 0x00, 0x80, 0x00, 0x01, 0x00, 0x02, 0x00, 0x08, 0x00, 0x80, 0x00, 0x01);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001, 0x0001,
           0x0001, 0x0001, 0x0001);
  VLOAD_16(v3, 0, 1, 2, 3, 7, 15, 31, 32, 0, 1, 2, 3, 7, 15, 31, 32);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v4);
  asm volatile("vsll.vv v4, v2, v3, v0.t");
  VCMP_U16(6, v4, 0x0000, 0x0002, 0x0000, 0x0008, 0x0000, 0x8000, 0x0000, 0x0001, 0x0000, 0x0002, 0x0000, 0x0008,
           0x0000, 0x8000, 0x0000, 0x0001);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001,
           0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001, 0x00000001);
  VLOAD_32(v6, 0, 1, 2, 3, 7, 15, 31, 32, 0, 1, 2, 3, 7, 15, 31, 32);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v8);
  asm volatile("vsll.vv v8, v4, v6, v0.t");
  VCMP_U32(7, v8, 0x00000000, 0x00000002, 0x00000000, 0x00000008, 0x00000000, 0x00008000, 0x00000000, 0x00000001,
           0x00000000, 0x00000002, 0x00000000, 0x00000008, 0x00000000, 0x00008000, 0x00000000, 0x00000001);
};

void TEST_CASE3(void) {
  const uint64_t scalar = 2;

  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);
  asm volatile("vsll.vx v4, v2, %[A]" ::[A] "r"(scalar));
  VCMP_U8(9, v4, 0x04, 0x08, 0x0C, 0x10, 0x14, 0x18, 0x1C, 0x20, 0xE0, 0xE4, 0xE8, 0xEC, 0xF0, 0xF4, 0xF8, 0xFC);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB, 0xFFFC,
           0xFFFD, 0xFFFE, 0x00FF);
  asm volatile("vsll.vx v4, v2, %[A]" ::[A] "r"(scalar));
  VCMP_U16(10, v4, 0x0004, 0x0008, 0x000C, 0x0010, 0x0014, 0x0018, 0x001C, 0x0020, 0xFFE0, 0xFFE4, 0xFFE8, 0xFFEC,
           0xFFF0, 0xFFF4, 0xFFF8, 0x03FC);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000002, 0x00000003, 0x00000004, 0x00000005, 0x00000006, 0x00000007, 0x00000008,
           0xFFFFFFF8, 0xFFFFFFF9, 0xFFFFFFFA, 0xFFFFFFFB, 0xFFFFFFFC, 0xFFFFFFFD, 0xFFFFFFFE, 0x000000FF);
  asm volatile("vsll.vx v8, v4, %[A]" ::[A] "r"(scalar));
  VCMP_U32(11, v8, 0x00000004, 0x00000008, 0x0000000C, 0x00000010, 0x00000014, 0x00000018, 0x0000001C, 0x00000020,
           0xFFFFFFE0, 0xFFFFFFE4, 0xFFFFFFE8, 0xFFFFFFEC, 0xFFFFFFF0, 0xFFFFFFF4, 0xFFFFFFF8, 0x000003FC);
};

void TEST_CASE4(void) {
  const uint64_t scalar = 2;

  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);
  VCLEAR(v4);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vsll.vx v4, v2, %[A], v0.t" ::[A] "r"(scalar));
  VCMP_U8(13, v4, 0x00, 0x08, 0x00, 0x10, 0x00, 0x18, 0x00, 0x20, 0x00, 0xE4, 0x00, 0xEC, 0x00, 0xF4, 0x00, 0xFC);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB, 0xFFFC,
           0xFFFD, 0xFFFE, 0x00FF);
  VCLEAR(v4);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vsll.vx v4, v2, %[A], v0.t" ::[A] "r"(scalar));
  VCMP_U16(14, v4, 0x0000, 0x0008, 0x0000, 0x0010, 0x0000, 0x0018, 0x0000, 0x0020, 0x0000, 0xFFE4, 0x0000, 0xFFEC,
           0x0000, 0xFFF4, 0x0000, 0x03FC);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000002, 0x00000003, 0x00000004, 0x00000005, 0x00000006, 0x00000007, 0x00000008,
           0xFFFFFFF8, 0xFFFFFFF9, 0xFFFFFFFA, 0xFFFFFFFB, 0xFFFFFFFC, 0xFFFFFFFD, 0xFFFFFFFE, 0x000000FF);
  VCLEAR(v8);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vsll.vx v8, v4, %[A], v0.t" ::[A] "r"(scalar));
  VCMP_U32(15, v8, 0x00000000, 0x00000008, 0x00000000, 0x00000010, 0x00000000, 0x00000018, 0x00000000, 0x00000020,
           0x00000000, 0xFFFFFFE4, 0x00000000, 0xFFFFFFEC, 0x00000000, 0xFFFFFFF4, 0x00000000, 0x000003FC);
};

void TEST_CASE5(void) {
  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);
  asm volatile("vsll.vi v4, v2, 2");
  VCMP_U8(17, v4, 0x04, 0x08, 0x0C, 0x10, 0x14, 0x18, 0x1C, 0x20, 0xE0, 0xE4, 0xE8, 0xEC, 0xF0, 0xF4, 0xF8, 0xFC);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB, 0xFFFC,
           0xFFFD, 0xFFFE, 0x00FF);
  asm volatile("vsll.vi v4, v2, 2");
  VCMP_U16(18, v4, 0x0004, 0x0008, 0x000C, 0x0010, 0x0014, 0x0018, 0x001C, 0x0020, 0xFFE0, 0xFFE4, 0xFFE8, 0xFFEC,
           0xFFF0, 0xFFF4, 0xFFF8, 0x03FC);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000002, 0x00000003, 0x00000004, 0x00000005, 0x00000006, 0x00000007, 0x00000008,
           0xFFFFFFF8, 0xFFFFFFF9, 0xFFFFFFFA, 0xFFFFFFFB, 0xFFFFFFFC, 0xFFFFFFFD, 0xFFFFFFFE, 0x000000FF);
  asm volatile("vsll.vi v8, v4, 2");
  VCMP_U32(19, v8, 0x00000004, 0x00000008, 0x0000000C, 0x00000010, 0x00000014, 0x00000018, 0x0000001C, 0x00000020,
           0xFFFFFFE0, 0xFFFFFFE4, 0xFFFFFFE8, 0xFFFFFFEC, 0xFFFFFFF0, 0xFFFFFFF4, 0xFFFFFFF8, 0x000003FC);
};

void TEST_CASE6(void) {
  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);
  VCLEAR(v4);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vsll.vi v4, v2, 2, v0.t");
  VCMP_U8(21, v4, 0x00, 0x08, 0x00, 0x10, 0x00, 0x18, 0x00, 0x20, 0x00, 0xE4, 0x00, 0xEC, 0x00, 0xF4, 0x00, 0xFC);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB, 0xFFFC,
           0xFFFD, 0xFFFE, 0x00FF);
  VCLEAR(v4);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vsll.vi v4, v2, 2, v0.t");
  VCMP_U16(22, v4, 0x0000, 0x0008, 0x0000, 0x0010, 0x0000, 0x0018, 0x0000, 0x0020, 0x0000, 0xFFE4, 0x0000, 0xFFEC,
           0x0000, 0xFFF4, 0x0000, 0x03FC);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000002, 0x00000003, 0x00000004, 0x00000005, 0x00000006, 0x00000007, 0x00000008,
           0xFFFFFFF8, 0xFFFFFFF9, 0xFFFFFFFA, 0xFFFFFFFB, 0xFFFFFFFC, 0xFFFFFFFD, 0xFFFFFFFE, 0x000000FF);
  VCLEAR(v8);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vsll.vi v8, v4, 2, v0.t");
  VCMP_U32(23, v8, 0x00000000, 0x00000008, 0x00000000, 0x00000010, 0x00000000, 0x00000018, 0x00000000, 0x00000020,
           0x00000000, 0xFFFFFFE4, 0x00000000, 0xFFFFFFEC, 0x00000000, 0xFFFFFFF4, 0x00000000, 0x000003FC);
};

// Immediate is bigger than max shift amount
void TEST_CASE7(void) {
  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);
  asm volatile("vsll.vi v4, v2, 8");
  VCMP_U8(24, v4, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB, 0xFFFC,
           0xFFFD, 0xFFFE, 0x00FF);
  asm volatile("vsll.vi v4, v2, 16");
  VCMP_U16(25, v4, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB,
           0xFFFC, 0xFFFD, 0xFFFE, 0x00FF);
};

// Max shift amount
void TEST_CASE8(void) {
  VSET(16, e8, m1);
  VLOAD_8(v2, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xF8, 0xF9, 0xFA, 0xFB, 0xFC, 0xFD, 0xFE, 0xFF);
  asm volatile("vsll.vi v4, v2, 7");
  VCMP_U8(26, v4, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80);

  VSET(16, e16, m1);
  VLOAD_16(v2, 0x0001, 0x0002, 0x0003, 0x0004, 0x0005, 0x0006, 0x0007, 0x0008, 0xFFF8, 0xFFF9, 0xFFFA, 0xFFFB, 0xFFFC,
           0xFFFD, 0xFFFE, 0x00FF);
  asm volatile("vsll.vi v4, v2, 15");
  VCMP_U16(27, v4, 0x8000, 0x0000, 0x8000, 0x0000, 0x8000, 0x0000, 0x8000, 0x0000, 0x0000, 0x8000, 0x0000, 0x8000,
           0x0000, 0x8000, 0x0000, 0x8000);

  VSET(16, e32, m2);
  VLOAD_32(v4, 0x00000001, 0x00000002, 0x00000003, 0x00000004, 0x00000005, 0x00000006, 0x00000007, 0x00000008,
           0xFFFFFFF8, 0xFFFFFFF9, 0xFFFFFFFA, 0xFFFFFFFB, 0xFFFFFFFC, 0xFFFFFFFD, 0xFFFFFFFE, 0x000000FF);
  asm volatile("vsll.vi v8, v4, 31");
  VCMP_U32(28, v8, 0x80000000, 0x00000000, 0x80000000, 0x00000000, 0x80000000, 0x00000000, 0x80000000, 0x00000000,
           0x00000000, 0x80000000, 0x00000000, 0x80000000, 0x00000000, 0x80000000, 0x00000000, 0x80000000);
};

int main(void) {
  INIT_CHECK();
  enable_vec();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());
  TEST_CASE5();
  MASKED_TEST(TEST_CASE6());
  TEST_CASE7();
  TEST_CASE8();

  EXIT_CHECK();
}
