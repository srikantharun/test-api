// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matteo Perotti <mperotti@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values + 1 subnormal
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //               0.9390,  0.9619,  0.9121,  0.6265,  0.1193, -0.4492, -0.3562,
  //               0.2365, -0.9897,  0.8638, -0.0379, -0.6201,  0.1809,  0.9824,
  //               -0.9922, -0.6851
  VLOAD_16(v2, 0x3b83, 0x3bb2, 0x3b4c, 0x3903, 0x2fa2, 0xb730, 0xb5b3, 0x3391, 0xbbeb, 0x3ae9, 0xa8da, 0xb8f6, 0x31ca,
           0x3bdc, 0xbbf0, 0xb97b);
  //               0.9795, -0.1069,  0.7070, -0.7305,  0.0516, -0.1321,  0.3828,
  //               0.0230, -0.9424, -0.8652, -0.3865, -0.1719, -0.7021,  0.1664,
  //               0.7026, -0.8535
  VLOAD_16(v3, 0x3bd6, 0xaed8, 0x39a8, 0xb9d8, 0x2a9a, 0xb03a, 0x3620, 0x25e2, 0xbb8a, 0xbaec, 0xb62f, 0xb180, 0xb99e,
           0x3153, 0x399f, 0xbad4);
  asm volatile("vfmin.vv v1, v2, v3");
  //               0.9390, -0.1069,  0.7070, -0.7305,  0.0516, -0.4492, -0.3562,
  //               0.0230, -0.9897, -0.8652, -0.3865, -0.6201, -0.7021,  0.1664,
  //               -0.9922, -0.8535
  VCMP_U16(1, v1, 0x3b83, 0xaed8, 0x39a8, 0xb9d8, 0x2a9a, 0xb730, 0xb5b3, 0x25e2, 0xbbeb, 0xbaec, 0xb62f, 0xb8f6,
           0xb99e, 0x3153, 0xbbf0, 0xbad4);

  VSET(16, e32, m2);
  //               0.33477312, -0.14129849, -0.94871885,  0.83600986,
  //               -0.28163233, -0.47814348,  0.77408481, -0.54823470,
  //               -0.72419900,  0.27495387, -0.76835793,  0.71516198,
  //               0.32305571, -0.76598656, -0.36499983, -0.52954155
  VLOAD_32(v4, 0x3eab6762, 0xbe10b08d, 0xbf72df3d, 0x3f5604be, 0xbe90321d, 0xbef4cf39, 0x3f462a6c, 0xbf0c591c,
           0xbf39651b, 0x3e8cc6c1, 0xbf44b31b, 0x3f3714db, 0x3ea5678f, 0xbf4417b2, 0xbebae142, 0xbf079009);
  //               0.87184614,  0.40005061,  0.40118238,  0.97373396,
  //               0.74085194, -0.99458516, -0.73125440, -0.46319291,
  //               -0.76140571, -0.82557100,  0.15205561,  0.39971715,
  //               -0.32876521, -0.53106725,  0.84727478,  0.21940185
  VLOAD_32(v6, 0x3f5f314f, 0x3eccd36f, 0x3ecd67c7, 0x3f7946a1, 0x3f3da879, 0xbf7e9d22, 0xbf3b337d, 0xbeed279f,
           0xbf42eb7c, 0xbf53589f, 0x3e1bb477, 0x3ecca7ba, 0xbea853ea, 0xbf07f406, 0x3f58e700, 0x3e60aae1);
  asm volatile("vfmin.vv v2, v4, v6");
  //               0.33477312, -0.14129849, -0.94871885,  0.83600986,
  //               -0.28163233, -0.99458516, -0.73125440, -0.54823470,
  //               -0.76140571, -0.82557100, -0.76835793,  0.39971715,
  //               -0.32876521, -0.76598656, -0.36499983, -0.52954155
  VCMP_U32(2, v2, 0x3eab6762, 0xbe10b08d, 0xbf72df3d, 0x3f5604be, 0xbe90321d, 0xbf7e9d22, 0xbf3b337d, 0xbf0c591c,
           0xbf42eb7c, 0xbf53589f, 0xbf44b31b, 0x3ecca7ba, 0xbea853ea, 0xbf4417b2, 0xbebae142, 0xbf079009);
};

// Simple random test with similar values + 1 subnormal (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //               0.9390,  0.9619,  0.9121,  0.6265,  0.1193, -0.4492, -0.3562,
  //               0.2365, -0.9897,  0.8638, -0.0379, -0.6201,  0.1809,  0.9824,
  //               -0.9922, -0.6851
  VLOAD_16(v2, 0x3b83, 0x3bb2, 0x3b4c, 0x3903, 0x2fa2, 0xb730, 0xb5b3, 0x3391, 0xbbeb, 0x3ae9, 0xa8da, 0xb8f6, 0x31ca,
           0x3bdc, 0xbbf0, 0xb97b);
  //               0.9795, -0.1069,  0.7070, -0.7305,  0.0516, -0.1321,  0.3828,
  //               0.0230, -0.9424, -0.8652, -0.3865, -0.1719, -0.7021,  0.1664,
  //               0.7026, -0.8535
  VLOAD_16(v3, 0x3bd6, 0xaed8, 0x39a8, 0xb9d8, 0x2a9a, 0xb03a, 0x3620, 0x25e2, 0xbb8a, 0xbaec, 0xb62f, 0xb180, 0xb99e,
           0x3153, 0x399f, 0xbad4);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v1);
  asm volatile("vfmin.vv v1, v2, v3, v0.t");
  //               0.0000, -0.1069,  0.0000, -0.7305,  0.0000, -0.4492,  0.0000,
  //               0.0230,  0.0000, -0.8652,  0.0000, -0.6201,  0.0000,  0.1664,
  //               0.0000, -0.8535
  VCMP_U16(4, v1, 0x0, 0xaed8, 0x0, 0xb9d8, 0x0, 0xb730, 0x0, 0x25e2, 0x0, 0xbaec, 0x0, 0xb8f6, 0x0, 0x3153, 0x0,
           0xbad4);

  VSET(16, e32, m2);
  //               0.33477312, -0.14129849, -0.94871885,  0.83600986,
  //               -0.28163233, -0.47814348,  0.77408481, -0.54823470,
  //               -0.72419900,  0.27495387, -0.76835793,  0.71516198,
  //               0.32305571, -0.76598656, -0.36499983, -0.52954155
  VLOAD_32(v4, 0x3eab6762, 0xbe10b08d, 0xbf72df3d, 0x3f5604be, 0xbe90321d, 0xbef4cf39, 0x3f462a6c, 0xbf0c591c,
           0xbf39651b, 0x3e8cc6c1, 0xbf44b31b, 0x3f3714db, 0x3ea5678f, 0xbf4417b2, 0xbebae142, 0xbf079009);
  //               0.87184614,  0.40005061,  0.40118238,  0.97373396,
  //               0.74085194, -0.99458516, -0.73125440, -0.46319291,
  //               -0.76140571, -0.82557100,  0.15205561,  0.39971715,
  //               -0.32876521, -0.53106725,  0.84727478,  0.21940185
  VLOAD_32(v6, 0x3f5f314f, 0x3eccd36f, 0x3ecd67c7, 0x3f7946a1, 0x3f3da879, 0xbf7e9d22, 0xbf3b337d, 0xbeed279f,
           0xbf42eb7c, 0xbf53589f, 0x3e1bb477, 0x3ecca7ba, 0xbea853ea, 0xbf07f406, 0x3f58e700, 0x3e60aae1);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v2);
  asm volatile("vfmin.vv v2, v4, v6, v0.t");
  //               0.00000000, -0.14129849,  0.00000000,  0.83600986,
  //               0.00000000, -0.99458516,  0.00000000, -0.54823470,
  //               0.00000000, -0.82557100,  0.00000000,  0.39971715,
  //               0.00000000, -0.76598656,  0.00000000, -0.52954155
  VCMP_U32(5, v2, 0x0, 0xbe10b08d, 0x0, 0x3f5604be, 0x0, 0xbf7e9d22, 0x0, 0xbf0c591c, 0x0, 0xbf53589f, 0x0, 0x3ecca7ba,
           0x0, 0xbf4417b2, 0x0, 0xbf079009);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                              0.4434
  BOX_HALF_IN_FLOAT(fscalar_16, 0x3718);
  //              -0.2537,  0.5449,  0.2070, -0.5752, -0.3008,  0.0165, -0.8447,
  //              0.6279,  0.6802,  0.7300,  0.7720, -0.8525,  0.5264, -0.5249,
  //              -0.9839,  0.4875
  VLOAD_16(v2, 0xb40f, 0x385c, 0x32a0, 0xb89a, 0xb4d0, 0x2437, 0xbac2, 0x3906, 0x3971, 0x39d7, 0x3a2d, 0xbad2, 0x3836,
           0xb833, 0xbbdf, 0x37cd);
  asm volatile("vfmin.vf v1, v2, %[A]" ::[A] "f"(fscalar_16));
  //              -0.2537,  0.4434,  0.2070, -0.5752, -0.3008,  0.0165, -0.8447,
  //              0.4434,  0.4434,  0.4434,  0.4434, -0.8525,  0.4434, -0.5249,
  //              -0.9839,  0.4434
  VCMP_U16(7, v1, 0xb40f, 0x3718, 0x32a0, 0xb89a, 0xb4d0, 0x2437, 0xbac2, 0x3718, 0x3718, 0x3718, 0x3718, 0xbad2,
           0x3718, 0xb833, 0xbbdf, 0x3718);

  VSET(16, e32, m2);
  float fscalar_32;
  //                               0.59499639
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0x3f1851af);
  //              -0.94244474, -0.52559608, -0.72424960, -0.67824948,
  //              0.22003150, -0.67564118, -0.90376341,  0.16465612,
  //              -0.15494362, -0.01763406,  0.97777683, -0.91671157,
  //              0.81712914, -0.10151604,  0.03442690, -0.14597759
  VLOAD_32(v4, 0xbf71440f, 0xbf068d77, 0xbf39686c, 0xbf2da1c2, 0x3e614ff0, 0xbf2cf6d2, 0xbf675d0a, 0x3e289b9d,
           0xbe1ea98a, 0xbc90754e, 0x3f7a4f95, 0xbf6aad9c, 0x3f512f60, 0xbdcfe7a4, 0x3d0d0338, 0xbe157b26);
  asm volatile("vfmin.vf v2, v4, %[A]" ::[A] "f"(fscalar_32));
  //              -0.94244474, -0.52559608, -0.72424960, -0.67824948,
  //              0.22003150, -0.67564118, -0.90376341,  0.16465612,
  //              -0.15494362, -0.01763406,  0.59499639, -0.91671157,
  //              0.59499639, -0.10151604,  0.03442690, -0.14597759
  VCMP_U32(8, v2, 0xbf71440f, 0xbf068d77, 0xbf39686c, 0xbf2da1c2, 0x3e614ff0, 0xbf2cf6d2, 0xbf675d0a, 0x3e289b9d,
           0xbe1ea98a, 0xbc90754e, 0x3f1851af, 0xbf6aad9c, 0x3f1851af, 0xbdcfe7a4, 0x3d0d0338, 0xbe157b26);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                              0.4434
  BOX_HALF_IN_FLOAT(fscalar_16, 0x3718);
  //               -0.2537,  0.5449,  0.2070, -0.5752, -0.3008,  0.0165,
  //               -0.8447,  0.6279,  0.6802,  0.7300,  0.7720, -0.8525, 0.5264,
  //               -0.5249, -0.9839,  0.4875
  VLOAD_16(v2, 0xb40f, 0x385c, 0x32a0, 0xb89a, 0xb4d0, 0x2437, 0xbac2, 0x3906, 0x3971, 0x39d7, 0x3a2d, 0xbad2, 0x3836,
           0xb833, 0xbbdf, 0x37cd);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v1);
  asm volatile("vfmin.vf v1, v2, %[A], v0.t" ::[A] "f"(fscalar_16));
  //                0.0000,  0.4434,  0.0000, -0.5752,  0.0000,  0.0165, 0.0000,
  //                0.4434,  0.0000,  0.4434,  0.0000, -0.8525,  0.0000,
  //                -0.5249,  0.0000,  0.4434
  VCMP_U16(10, v1, 0x0, 0x3718, 0x0, 0xb89a, 0x0, 0x2437, 0x0, 0x3718, 0x0, 0x3718, 0x0, 0xbad2, 0x0, 0xb833, 0x0,
           0x3718);

  VSET(16, e32, m2);
  float fscalar_32;
  //                               0.59499639
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0x3f1851af);
  //               -0.94244474, -0.52559608, -0.72424960, -0.67824948,
  //               0.22003150, -0.67564118, -0.90376341,  0.16465612,
  //               -0.15494362, -0.01763406,  0.97777683, -0.91671157,
  //               0.81712914, -0.10151604,  0.03442690, -0.14597759
  VLOAD_32(v4, 0xbf71440f, 0xbf068d77, 0xbf39686c, 0xbf2da1c2, 0x3e614ff0, 0xbf2cf6d2, 0xbf675d0a, 0x3e289b9d,
           0xbe1ea98a, 0xbc90754e, 0x3f7a4f95, 0xbf6aad9c, 0x3f512f60, 0xbdcfe7a4, 0x3d0d0338, 0xbe157b26);
  VLOAD_8(v0, 0xAA, 0xAA);
  VCLEAR(v2);
  asm volatile("vfmin.vf v2, v4, %[A], v0.t" ::[A] "f"(fscalar_32));
  //                0.00000000, -0.52559608,  0.00000000, -0.67824948,
  //                0.00000000, -0.67564118,  0.00000000,  0.16465612,
  //                0.00000000, -0.01763406,  0.00000000, -0.91671157,
  //                0.00000000, -0.10151604,  0.00000000, -0.14597759
  VCMP_U32(11, v2, 0x0, 0xbf068d77, 0x0, 0xbf2da1c2, 0x0, 0xbf2cf6d2, 0x0, 0x3e289b9d, 0x0, 0xbc90754e, 0x0, 0xbf6aad9c,
           0x0, 0xbdcfe7a4, 0x0, 0xbe157b26);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
