// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matteo Perotti <mperotti@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //              -0.7461,  0.0514, -0.3071, -0.4934, -0.5220, -0.7983,  0.4907,
  //              -0.9028,  0.1752,  0.0676,  0.1040,  0.4526,  0.3525, -0.2686,
  //              0.3540, -0.0847
  VLOAD_16(v2, 0xb9f8, 0x2a94, 0xb4ea, 0xb7e5, 0xb82d, 0xba63, 0x37da, 0xbb39, 0x319b, 0x2c54, 0x2ea8, 0x373e, 0x35a4,
           0xb44c, 0x35aa, 0xad6c);
  //               0.1573, -0.7700,  0.0804, -0.9438,  0.0790,  0.7998, -0.2854,
  //               0.1963, -0.0687, -0.2123,  0.3625, -0.0002,  0.7168, -0.4033,
  //               0.2812, -0.3159
  VLOAD_16(v3, 0x3109, 0xba29, 0x2d25, 0xbb8d, 0x2d0e, 0x3a66, 0xb491, 0x3248, 0xac65, 0xb2cb, 0x35cd, 0x897c, 0x39bc,
           0xb674, 0x3480, 0xb50e);
  //               0.0337,  0.2034, -0.1886,  0.8242,  0.3225,  0.0331,  0.0698,
  //               0.6777, -0.2539, -0.5825, -0.4319, -0.6323,  0.0674, -0.2903,
  //               -0.8145,  0.1893
  VLOAD_16(v1, 0x284f, 0x3282, 0xb209, 0x3a98, 0x3529, 0x283b, 0x2c77, 0x396c, 0xb410, 0xb8a9, 0xb6e9, 0xb90f, 0x2c50,
           0xb4a5, 0xba84, 0x320f);
  asm volatile("vfnmadd.vv v1, v2, v3");
  //              -0.1322,  0.7598, -0.1383,  1.3506,  0.0894, -0.7734,  0.2512,
  //              0.4155,  0.1132,  0.2517, -0.3176,  0.2864, -0.7407,  0.3254,
  //              0.0071,  0.3320
  VCMP_U16(1, v1, 0xb03b, 0x3a14, 0xb06d, 0x3d67, 0x2db8, 0xba30, 0x3405, 0x36a6, 0x2f3e, 0x3407, 0xb515, 0x3495,
           0xb9ed, 0x3535, 0x1f3d, 0x3550);

  VSET(16, e32, m2);
  //              -0.36820358,  0.10496315, -0.32905263, -0.92334682,
  //              0.43153936,  0.92736709, -0.59600371,  0.75117606, 0.84123290,
  //              0.33028743, -0.43412161,  0.95273590,  0.06816643,
  //              -0.88978988,  0.18573478,  0.61926919
  VLOAD_32(v4, 0xbebc852e, 0x3dd6f6ec, 0xbea87996, 0xbf6c6075, 0x3edcf2ba, 0x3f6d67ee, 0xbf1893b3, 0x3f404d13,
           0x3f575b0a, 0x3ea91b6f, 0xbede4530, 0x3f73e680, 0x3d8b9ad8, 0xbf63c945, 0x3e3e3142, 0x3f1e886d);
  //               0.69083834, -0.31329882, -0.54809541,  0.25019145,
  //               -0.67489260,  0.23259214, -0.14038530,  0.09741956,
  //               -0.23567833,  0.75417399, -0.90357685, -0.87489468,
  //               0.54726779, -0.06705534, -0.15476358, -0.96940458
  VLOAD_32(v6, 0x3f30dac8, 0xbea068b4, 0xbf0c4ffb, 0x3e801918, 0xbf2cc5c3, 0x3e6e2ca2, 0xbe0fc12a, 0x3dc783e8,
           0xbe7155a9, 0x3f41118c, 0xbf6750d0, 0xbf5ff919, 0x3f0c19be, 0xbd895450, 0xbe1e7a58, 0xbf782ae6);
  //               0.03722767,  0.80796093,  0.53925264, -0.50804031,
  //               0.63562357, -0.45508829, -0.22051410,  0.42499006,
  //               -0.59229839, -0.50074077, -0.80474108, -0.20762257,
  //               0.15367362,  0.98349953, -0.15871963, -0.07445616
  VLOAD_32(v2, 0x3d187c0a, 0x3f4ed687, 0x3f0a0c76, 0xbf020eee, 0x3f22b83a, 0xbee90155, 0xbe61ce73, 0x3ed9984c,
           0xbf17a0de, 0xbf00308c, 0xbf4e0383, 0xbe549b03, 0x3e1d5c9e, 0x3f7bc6a0, 0xbe228766, 0xbd987c79);
  asm volatile("vfnmadd.vv v2, v4, v6");
  //              -0.67713100,  0.22849269,  0.72553790, -0.71928883,
  //              0.40059602,  0.18944177,  0.00895807, -0.41666192, 0.73393923,
  //              -0.58878565,  0.55422139,  1.07270420, -0.55774319,
  //              0.94216329,  0.18424334,  1.01551294
  VCMP_U32(2, v2, 0xbf2d5875, 0x3e69f9fd, 0x3f39bcda, 0xbf382350, 0x3ecd1aec, 0x3e41fd06, 0x3c12c4e5, 0xbed554b6,
           0x3f3be371, 0xbf16baa7, 0x3f0de173, 0x3f894e5f, 0xbf0ec842, 0x3f71319d, 0x3e3caa49, 0x3f81fc54);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //              -0.7461,  0.0514, -0.3071, -0.4934, -0.5220, -0.7983,  0.4907,
  //              -0.9028,  0.1752,  0.0676,  0.1040,  0.4526,  0.3525, -0.2686,
  //              0.3540, -0.0847
  VLOAD_16(v2, 0xb9f8, 0x2a94, 0xb4ea, 0xb7e5, 0xb82d, 0xba63, 0x37da, 0xbb39, 0x319b, 0x2c54, 0x2ea8, 0x373e, 0x35a4,
           0xb44c, 0x35aa, 0xad6c);
  //               0.1573, -0.7700,  0.0804, -0.9438,  0.0790,  0.7998, -0.2854,
  //               0.1963, -0.0687, -0.2123,  0.3625, -0.0002,  0.7168, -0.4033,
  //               0.2812, -0.3159
  VLOAD_16(v3, 0x3109, 0xba29, 0x2d25, 0xbb8d, 0x2d0e, 0x3a66, 0xb491, 0x3248, 0xac65, 0xb2cb, 0x35cd, 0x897c, 0x39bc,
           0xb674, 0x3480, 0xb50e);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               0.0337,  0.2034, -0.1886,  0.8242,  0.3225,  0.0331,  0.0698,
  //               0.6777, -0.2539, -0.5825, -0.4319, -0.6323,  0.0674, -0.2903,
  //               -0.8145,  0.1893
  VLOAD_16(v1, 0x284f, 0x3282, 0xb209, 0x3a98, 0x3529, 0x283b, 0x2c77, 0x396c, 0xb410, 0xb8a9, 0xb6e9, 0xb90f, 0x2c50,
           0xb4a5, 0xba84, 0x320f);
  asm volatile("vfnmadd.vv v1, v2, v3, v0.t");
  //               0.0337,  0.7598, -0.1886,  1.3506,  0.3225, -0.7734,  0.0698,
  //               0.4155, -0.2539,  0.2517, -0.4319,  0.2864,  0.0674,  0.3254,
  //               -0.8145,  0.3320
  VCMP_U16(4, v1, 0x284f, 0x3a14, 0xb209, 0x3d67, 0x3529, 0xba30, 0x2c77, 0x36a6, 0xb410, 0x3407, 0xb6e9, 0x3495,
           0x2c50, 0x3535, 0xba84, 0x3550);

  VSET(16, e32, m2);
  //              -0.36820358,  0.10496315, -0.32905263, -0.92334682,
  //              0.43153936,  0.92736709, -0.59600371,  0.75117606, 0.84123290,
  //              0.33028743, -0.43412161,  0.95273590,  0.06816643,
  //              -0.88978988,  0.18573478,  0.61926919
  VLOAD_32(v4, 0xbebc852e, 0x3dd6f6ec, 0xbea87996, 0xbf6c6075, 0x3edcf2ba, 0x3f6d67ee, 0xbf1893b3, 0x3f404d13,
           0x3f575b0a, 0x3ea91b6f, 0xbede4530, 0x3f73e680, 0x3d8b9ad8, 0xbf63c945, 0x3e3e3142, 0x3f1e886d);
  //               0.69083834, -0.31329882, -0.54809541,  0.25019145,
  //               -0.67489260,  0.23259214, -0.14038530,  0.09741956,
  //               -0.23567833,  0.75417399, -0.90357685, -0.87489468,
  //               0.54726779, -0.06705534, -0.15476358, -0.96940458
  VLOAD_32(v6, 0x3f30dac8, 0xbea068b4, 0xbf0c4ffb, 0x3e801918, 0xbf2cc5c3, 0x3e6e2ca2, 0xbe0fc12a, 0x3dc783e8,
           0xbe7155a9, 0x3f41118c, 0xbf6750d0, 0xbf5ff919, 0x3f0c19be, 0xbd895450, 0xbe1e7a58, 0xbf782ae6);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               0.03722767,  0.80796093,  0.53925264, -0.50804031,
  //               0.63562357, -0.45508829, -0.22051410,  0.42499006,
  //               -0.59229839, -0.50074077, -0.80474108, -0.20762257,
  //               0.15367362,  0.98349953, -0.15871963, -0.07445616
  VLOAD_32(v2, 0x3d187c0a, 0x3f4ed687, 0x3f0a0c76, 0xbf020eee, 0x3f22b83a, 0xbee90155, 0xbe61ce73, 0x3ed9984c,
           0xbf17a0de, 0xbf00308c, 0xbf4e0383, 0xbe549b03, 0x3e1d5c9e, 0x3f7bc6a0, 0xbe228766, 0xbd987c79);
  asm volatile("vfnmadd.vv v2, v4, v6, v0.t");
  //               0.03722767,  0.22849269,  0.53925264, -0.71928883,
  //               0.63562357,  0.18944177, -0.22051410, -0.41666192,
  //               -0.59229839, -0.58878565, -0.80474108,  1.07270420,
  //               0.15367362,  0.94216329, -0.15871963,  1.01551294
  VCMP_U32(5, v2, 0x3d187c0a, 0x3e69f9fd, 0x3f0a0c76, 0xbf382350, 0x3f22b83a, 0x3e41fd06, 0xbe61ce73, 0xbed554b6,
           0xbf17a0de, 0xbf16baa7, 0xbf4e0383, 0x3f894e5f, 0x3e1d5c9e, 0x3f71319d, 0xbe228766, 0x3f81fc54);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                              0.2646
  BOX_HALF_IN_FLOAT(fscalar_16, 0x343c);
  //               0.4216, -0.2148,  0.0047,  0.6802, -0.8965, -0.2986, -0.1786,
  //               -0.1904,  0.2805,  0.5322, -0.5298,  0.3208,  0.0567,
  //               -0.9897, -0.5400, -0.4187
  VLOAD_16(v2, 0x36bf, 0xb2e0, 0x1cc3, 0x3971, 0xbb2c, 0xb4c7, 0xb1b7, 0xb218, 0x347d, 0x3842, 0xb83d, 0x3522, 0x2b41,
           0xbbeb, 0xb852, 0xb6b3);
  //              -0.7886, -0.5435, -0.8345,  0.7793,  0.5796, -0.8374, -0.8623,
  //              -0.3313, -0.2690, -0.9214,  0.2126, -0.6772, -0.6514, -0.5703,
  //              -0.2585, -0.3320
  VLOAD_16(v1, 0xba4f, 0xb859, 0xbaad, 0x3a3c, 0x38a3, 0xbab3, 0xbae6, 0xb54d, 0xb44e, 0xbb5f, 0x32ce, 0xb96b, 0xb936,
           0xb890, 0xb423, 0xb550);
  asm volatile("vfnmadd.vf v1, %[A], v2" ::[A] "f"(fscalar_16));
  //              -0.2129,  0.3586,  0.2162, -0.8867,  0.7432,  0.5200,  0.4067,
  //              0.2781, -0.2092, -0.2883,  0.4736, -0.1416,  0.1157,  1.1406,
  //              0.6084,  0.5068
  VCMP_U16(7, v1, 0xb2d0, 0x35bd, 0x32eb, 0xbb17, 0x39f2, 0x3829, 0x3682, 0x3473, 0xb2b3, 0xb49d, 0x3793, 0xb088,
           0x2f68, 0x3c90, 0x38de, 0x380d);

  VSET(16, e32, m2);
  float fscalar_32;
  //                              -0.13809182
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0xbe0d67f1);
  //              -0.16977388, -0.30800357, -0.37010264, -0.92290556,
  //              0.55768263,  0.47349435,  0.77556002,  0.16363664, 0.80314618,
  //              -0.48171839, -0.60694915,  0.16937894,  0.86316317,
  //              0.00897404, -0.96310323, -0.27890080
  VLOAD_32(v4, 0xbe2dd934, 0xbe9db2a5, 0xbebd7e18, 0xbf6c438a, 0x3f0ec44a, 0x3ef26dda, 0x3f468b1a, 0x3e27905d,
           0x3f4d9afd, 0xbef6a3cb, 0xbf1b6105, 0x3e2d71ac, 0x3f5cf843, 0x3c1307df, 0xbf768def, 0xbe8ecc16);
  //              -0.33133313, -0.48972869,  0.95656961, -0.89211702,
  //              0.72045243, -0.36672497,  0.69402671,  0.44954479,
  //              -0.77024877, -0.83221292,  0.37576449, -0.77536738,
  //              -0.55040795, -0.71568310, -0.75874990,  0.91956782
  VLOAD_32(v2, 0xbea9a47f, 0xbefabdb8, 0x3f74e1bf, 0xbf6461c8, 0x3f386f92, 0xbebbc360, 0x3f31abbc, 0x3ee62abc,
           0xbf452f06, 0xbf550be8, 0x3ec06434, 0xbf467e7a, 0xbf0ce789, 0xbf373702, 0xbf423d6f, 0x3f6b68cc);
  asm volatile("vfnmadd.vf v2, %[A], v4" ::[A] "f"(fscalar_32));
  //               0.12401948,  0.24037606,  0.50219709,  0.79971153,
  //               -0.45819405, -0.52413607, -0.67972064, -0.10155818,
  //               -0.90951121,  0.36679661,  0.65883917, -0.27645081,
  //               -0.93917000, -0.10780402,  0.85832608,  0.40588558
  VCMP_U32(8, v2, 0x3dfdfded, 0x3e762524, 0x3f008ffd, 0x3f4cb9e5, 0xbeea9869, 0xbf062dc8, 0xbf2e022c, 0xbdcffdbd,
           0xbf68d5ba, 0x3ebbccc3, 0x3f28a9af, 0xbe8d8af6, 0xbf706d72, 0xbddcc85b, 0x3f5bbb42, 0x3ecfd03d);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                              0.2646
  BOX_HALF_IN_FLOAT(fscalar_16, 0x343c);
  //                0.4216, -0.2148,  0.0047,  0.6802, -0.8965, -0.2986,
  //                -0.1786, -0.1904,  0.2805,  0.5322, -0.5298,  0.3208,
  //                0.0567, -0.9897, -0.5400, -0.4187
  VLOAD_16(v2, 0x36bf, 0xb2e0, 0x1cc3, 0x3971, 0xbb2c, 0xb4c7, 0xb1b7, 0xb218, 0x347d, 0x3842, 0xb83d, 0x3522, 0x2b41,
           0xbbeb, 0xb852, 0xb6b3);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               -0.7886, -0.5435, -0.8345,  0.7793,  0.5796, -0.8374,
  //               -0.8623, -0.3313, -0.2690, -0.9214,  0.2126, -0.6772,
  //               -0.6514, -0.5703, -0.2585, -0.3320
  VLOAD_16(v1, 0xba4f, 0xb859, 0xbaad, 0x3a3c, 0x38a3, 0xbab3, 0xbae6, 0xb54d, 0xb44e, 0xbb5f, 0x32ce, 0xb96b, 0xb936,
           0xb890, 0xb423, 0xb550);
  asm volatile("vfnmadd.vf v1, %[A], v2, v0.t" ::[A] "f"(fscalar_16));
  //               -0.7886,  0.3586, -0.8345, -0.8867,  0.5796,  0.5200,
  //               -0.8623,  0.2781, -0.2690, -0.2883,  0.2126, -0.1416,
  //               -0.6514,  1.1406, -0.2585,  0.5068
  VCMP_U16(10, v1, 0xba4f, 0x35bd, 0xbaad, 0xbb17, 0x38a3, 0x3829, 0xbae6, 0x3473, 0xb44e, 0xb49d, 0x32ce, 0xb088,
           0xb936, 0x3c90, 0xb423, 0x380d);

  VSET(16, e32, m2);
  float fscalar_32;
  //                              -0.13809182
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0xbe0d67f1);
  //               -0.16977388, -0.30800357, -0.37010264, -0.92290556,
  //               0.55768263,  0.47349435,  0.77556002,  0.16363664,
  //               0.80314618, -0.48171839, -0.60694915,  0.16937894,
  //               0.86316317,  0.00897404, -0.96310323, -0.27890080
  VLOAD_32(v4, 0xbe2dd934, 0xbe9db2a5, 0xbebd7e18, 0xbf6c438a, 0x3f0ec44a, 0x3ef26dda, 0x3f468b1a, 0x3e27905d,
           0x3f4d9afd, 0xbef6a3cb, 0xbf1b6105, 0x3e2d71ac, 0x3f5cf843, 0x3c1307df, 0xbf768def, 0xbe8ecc16);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               -0.33133313, -0.48972869,  0.95656961, -0.89211702,
  //               0.72045243, -0.36672497,  0.69402671,  0.44954479,
  //               -0.77024877, -0.83221292,  0.37576449, -0.77536738,
  //               -0.55040795, -0.71568310, -0.75874990,  0.91956782
  VLOAD_32(v2, 0xbea9a47f, 0xbefabdb8, 0x3f74e1bf, 0xbf6461c8, 0x3f386f92, 0xbebbc360, 0x3f31abbc, 0x3ee62abc,
           0xbf452f06, 0xbf550be8, 0x3ec06434, 0xbf467e7a, 0xbf0ce789, 0xbf373702, 0xbf423d6f, 0x3f6b68cc);
  asm volatile("vfnmadd.vf v2, %[A], v4, v0.t" ::[A] "f"(fscalar_32));
  //               -0.33133313,  0.24037606,  0.95656961,  0.79971153,
  //               0.72045243, -0.52413607,  0.69402671, -0.10155818,
  //               -0.77024877,  0.36679661,  0.37576449, -0.27645081,
  //               -0.55040795, -0.10780402, -0.75874990,  0.40588558
  VCMP_U32(11, v2, 0xbea9a47f, 0x3e762524, 0x3f74e1bf, 0x3f4cb9e5, 0x3f386f92, 0xbf062dc8, 0x3f31abbc, 0xbdcffdbd,
           0xbf452f06, 0x3ebbccc3, 0x3ec06434, 0xbe8d8af6, 0xbf0ce789, 0xbddcc85b, 0xbf423d6f, 0x3ecfd03d);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
