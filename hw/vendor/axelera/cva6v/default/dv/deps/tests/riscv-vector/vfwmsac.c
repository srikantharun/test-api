// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>
//         Matteo Perotti <mperotti@iis.ee.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //              -93.0000, -55.1250, -68.5625,  76.3125, -61.2188,  48.9375,
  //              -56.3125,  71.0000, -74.5625, -38.7188,
  //              -50.3438,  93.3750,  80.2500, -7.4141,  93.8125,  83.1875
  VLOAD_16(v2, 0xd5d0, 0xd2e4, 0xd449, 0x54c5, 0xd3a7, 0x521e, 0xd30a, 0x5470, 0xd4a9, 0xd0d7, 0xd24b, 0x55d6, 0x5504,
           0xc76a, 0x55dd, 0x5533);
  //              -60.0312, -31.7188, -74.2500, -0.9077,  30.4844, -56.2500,
  //              -4.8320,  34.2812,  66.6875,  37.9375,  78.1875,  5.6094,
  //              -81.8125,  67.6250,  29.4531, -64.9375
  VLOAD_16(v6, 0xd381, 0xcfee, 0xd4a4, 0xbb43, 0x4f9f, 0xd308, 0xc4d5, 0x5049, 0x542b, 0x50be, 0x54e3, 0x459c, 0xd51d,
           0x543a, 0x4f5d, 0xd40f);
  //               31.29529381, -66.12346649,
  //               -48.59321213,  21.66906929,  92.08473206,  1.95985305,
  //               -96.55027771,  77.65225220, -82.48660278,
  //               -35.32508850,  42.91923141,
  //               -76.65069580,  25.13817024,  72.89311981,  21.44047737,  69.71634674
  VLOAD_32(v4, 0x41fa5cc3, 0xc2843f37, 0xc2425f73, 0x41ad5a41, 0x42b82b62, 0x3ffadc77, 0xc2c119be, 0x429b4df4,
           0xc2a4f924, 0xc20d4ce4, 0x422bad4b, 0xc2994d28, 0x41c91af9, 0x4291c947, 0x41ab8619, 0x428b6ec5);
  asm volatile("vfwmsac.vv v4, v2, v6");
  VSET(16, e32, m2);
  //               5551.61083984,  1814.61950684,  5139.35888672, -90.93905640,
  //               -1958.30004883, -2754.69433594,  368.65405273, 2356.31640625,
  //               -4889.89990234, -1433.56750488, -3979.17114258, 600.42608643,
  //               -6590.59130859, -574.26910400,  2741.63085938, -5471.70458984
  VCMP_U32(1, v4, 0x45ad7ce3, 0x44e2d3d3, 0x45a09adf, 0xc2b5e0cc, 0xc4f4c99a, 0xc52c2b1c, 0x43b853b8, 0x45134510,
           0xc598cf33, 0xc4b33229, 0xc578b2bd, 0x44161b45, 0xc5cdf4bb, 0xc40f9139, 0x452b5a18, 0xc5aafda3);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //              -93.0000, -55.1250, -68.5625,  76.3125, -61.2188,  48.9375,
  //              -56.3125,  71.0000, -74.5625, -38.7188,
  //              -50.3438,  93.3750,  80.2500, -7.4141,  93.8125,  83.1875
  VLOAD_16(v2, 0xd5d0, 0xd2e4, 0xd449, 0x54c5, 0xd3a7, 0x521e, 0xd30a, 0x5470, 0xd4a9, 0xd0d7, 0xd24b, 0x55d6, 0x5504,
           0xc76a, 0x55dd, 0x5533);
  //              -60.0312, -31.7188, -74.2500, -0.9077,  30.4844, -56.2500,
  //              -4.8320,  34.2812,  66.6875,  37.9375,  78.1875,  5.6094,
  //              -81.8125,  67.6250,  29.4531, -64.9375
  VLOAD_16(v6, 0xd381, 0xcfee, 0xd4a4, 0xbb43, 0x4f9f, 0xd308, 0xc4d5, 0x5049, 0x542b, 0x50be, 0x54e3, 0x459c, 0xd51d,
           0x543a, 0x4f5d, 0xd40f);
  //               31.29529381, -66.12346649,
  //               -48.59321213,  21.66906929,  92.08473206,  1.95985305,
  //               -96.55027771,  77.65225220, -82.48660278,
  //               -35.32508850,  42.91923141,
  //               -76.65069580,  25.13817024,  72.89311981,  21.44047737,  69.71634674
  VLOAD_32(v4, 0x41fa5cc3, 0xc2843f37, 0xc2425f73, 0x41ad5a41, 0x42b82b62, 0x3ffadc77, 0xc2c119be, 0x429b4df4,
           0xc2a4f924, 0xc20d4ce4, 0x422bad4b, 0xc2994d28, 0x41c91af9, 0x4291c947, 0x41ab8619, 0x428b6ec5);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vfwmsac.vv v4, v2, v6, v0.t");
  VSET(16, e32, m2);
  //               31.29529381,  1814.61950684, -48.59321213,
  //               -90.93905640,  92.08473206, -2754.69433594, -96.55027771,
  //               2356.31640625, -82.48660278, -1433.56750488,  42.91923141,
  //               600.42608643,  25.13817024, -574.26910400,  21.44047737,
  //               -5471.70458984
  VCMP_U32(2, v4, 0x41fa5cc3, 0x44e2d3d3, 0xc2425f73, 0xc2b5e0cc, 0x42b82b62, 0xc52c2b1c, 0xc2c119be, 0x45134510,
           0xc2a4f924, 0xc4b33229, 0x422bad4b, 0x44161b45, 0x41c91af9, 0xc40f9139, 0x41ab8619, 0xc5aafda3);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //               8.1562,  2.6836,  56.7188,  38.4688,  33.8125,
  //               -83.0625,  37.7812, -28.0938, -33.0625,  61.1562,  13.0859,
  //               -80.5000,  78.3125, -38.0625,  30.0625, -78.6250
  VLOAD_16(v2, 0x4814, 0x415e, 0x5317, 0x50cf, 0x503a, 0xd531, 0x50b9, 0xcf06, 0xd022, 0x53a5, 0x4a8b, 0xd508, 0x54e5,
           0xd0c2, 0x4f84, 0xd4ea);
  //               56.66989136,  59.83663559, -8.21133614, -19.17305374,
  //               -93.35797119, -34.25491333,  46.99548721,
  //               -6.17113161,  55.22229004,  7.96844339, -92.84493256,
  //               -90.90106201,  78.59468842, -58.67407608,  39.90958405,
  //               -93.58789825
  VLOAD_32(v4, 0x4262adf8, 0x426f58b7, 0xc10361a2, 0xc199626a, 0xc2bab748, 0xc2090508, 0x423bfb61, 0xc0c579e9,
           0x425ce3a0, 0x40fefd7d, 0xc2b9b09b, 0xc2b5cd58, 0x429d307b, 0xc26ab241, 0x421fa36a, 0xc2bb2d01);
  //                              39.8125
  BOX_HALF_IN_FLOAT(fscalar_16, 0x50fa);
  asm volatile("vfwmsac.vf v4, %[A], v2" ::[A] "f"(fscalar_16));
  VSET(16, e32, m2);
  //               268.05081177,  47.00394058,  2266.32666016,  1550.71020508,
  //               1439.51806641, -3272.67089844,  1457.17053223,
  //               -1112.31127930, -1371.52307129,  2426.81469727, 613.82879639,
  //               -3114.00512695,  3039.22167969, -1456.68920898,
  //               1156.95373535, -3036.66992188
  VCMP_U32(3, v4, 0x43860681, 0x423c0409, 0x450da53a, 0x44c1d6ba, 0x44b3f094, 0xc54c8abc, 0x44b62575, 0xc48b09f6,
           0xc4ab70bd, 0x4517ad09, 0x4419750b, 0xc542a015, 0x453df38c, 0xc4b6160e, 0x44909e85, 0xc53dcab8);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //                8.1562,  2.6836,  56.7188,  38.4688,  33.8125,
  //                -83.0625,  37.7812, -28.0938, -33.0625,  61.1562,  13.0859,
  //                -80.5000,  78.3125, -38.0625,  30.0625, -78.6250
  VLOAD_16(v2, 0x4814, 0x415e, 0x5317, 0x50cf, 0x503a, 0xd531, 0x50b9, 0xcf06, 0xd022, 0x53a5, 0x4a8b, 0xd508, 0x54e5,
           0xd0c2, 0x4f84, 0xd4ea);
  //                56.66989136,  59.83663559, -8.21133614, -19.17305374,
  //                -93.35797119, -34.25491333,  46.99548721,
  //                -6.17113161,  55.22229004,  7.96844339, -92.84493256,
  //                -90.90106201,  78.59468842, -58.67407608,  39.90958405,
  //                -93.58789825
  VLOAD_32(v4, 0x4262adf8, 0x426f58b7, 0xc10361a2, 0xc199626a, 0xc2bab748, 0xc2090508, 0x423bfb61, 0xc0c579e9,
           0x425ce3a0, 0x40fefd7d, 0xc2b9b09b, 0xc2b5cd58, 0x429d307b, 0xc26ab241, 0x421fa36a, 0xc2bb2d01);
  VLOAD_8(v0, 0xAA, 0xAA);
  //                              39.8125
  BOX_HALF_IN_FLOAT(fscalar_16, 0x50fa);
  asm volatile("vfwmsac.vf v4, %[A], v2, v0.t" ::[A] "f"(fscalar_16));
  VSET(16, e32, m2);
  //                56.66989136,  47.00394058, -8.21133614,  1550.71020508,
  //                -93.35797119, -3272.67089844,  46.99548721,
  //                -1112.31127930,  55.22229004,  2426.81469727, -92.84493256,
  //                -3114.00512695,  78.59468842, -1456.68920898,  39.90958405,
  //                -3036.66992188
  VCMP_U32(4, v4, 0x4262adf8, 0x423c0409, 0xc10361a2, 0x44c1d6ba, 0xc2bab748, 0xc54c8abc, 0x423bfb61, 0xc48b09f6,
           0x425ce3a0, 0x4517ad09, 0xc2b9b09b, 0xc542a015, 0x429d307b, 0xc4b6160e, 0x421fa36a, 0xc53dcab8);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
