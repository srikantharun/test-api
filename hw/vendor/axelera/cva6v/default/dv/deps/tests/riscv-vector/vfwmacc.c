// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matheus Cavalcante <matheusd@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>
//         Matteo Perotti <mperotti@iis.ee.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m1);
  //               52.7812,  74.1875,  0.3564,  97.5000,  7.8477,  53.2188,
  //               -26.4688, -48.1250, -32.9688,  7.8750,
  //               -38.4375,  51.5625,  46.2188, -75.1875,  23.5625, -77.8125
  VLOAD_16(v2, 0x5299, 0x54a3, 0x35b4, 0x5618, 0x47d9, 0x52a7, 0xce9e, 0xd204, 0xd01f, 0x47e0, 0xd0ce, 0x5272, 0x51c7,
           0xd4b3, 0x4de4, 0xd4dd);
  //               49.6875,  28.5312,  13.4766, -90.5625,  58.0000,
  //               -63.8125,  49.0625,  0.3325,  30.8906,  11.2266, -93.9375,
  //               -54.6875,  61.7500,  38.3438,  95.8125,  10.0938
  VLOAD_16(v6, 0x5236, 0x4f22, 0x4abd, 0xd5a9, 0x5340, 0xd3fa, 0x5222, 0x3552, 0x4fb9, 0x499d, 0xd5df, 0xd2d6, 0x53b8,
           0x50cb, 0x55fd, 0x490c);
  //              -83.87223053, -48.34465408,  70.48658752, -1.26614821,
  //              -24.13150024, -65.13838196,
  //              0.84671319,  34.34510040,  72.80049896,
  //              -86.23424530,  25.52654839, -68.44364929,  9.81109142,
  //              -85.20966339, -81.00300598,  16.25512505
  VLOAD_32(v4, 0xc2a7be95, 0xc24160ed, 0x428cf922, 0xbfa21125, 0xc1c10d50, 0xc28246da, 0x3f58c232, 0x42096162,
           0x429199db, 0xc2ac77ef, 0x41cc365f, 0xc288e326, 0x411cfa3b, 0xc2aa6b59, 0xc2a2018a, 0x41820a7f);
  asm volatile("vfwmacc.vv v4, v2, v6");
  VSET(16, e32, m2);
  //               2538.69604492,  2068.31738281,  75.29024506, -8831.11035156,
  //               431.03256226, -3461.15991211, -1297.77636719,  18.34259796,
  //               -945.62481689,  2.17493439,  3636.24926758, -2888.26782227,
  //               2863.81884766, -2968.18041992,  2176.57910156, -769.16479492
  VCMP_U32(1, v4, 0x451eab23, 0x45014514, 0x4296949b, 0xc609fc71, 0x43d7842b, 0xc558528f, 0xc4a238d8, 0x4192bda4,
           0xc46c67fd, 0x400b3220, 0x456343fd, 0xc5348449, 0x4532fd1a, 0xc53982e3, 0x45080944, 0xc4404a8c);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m1);
  //               52.7812,  74.1875,  0.3564,  97.5000,  7.8477,  53.2188,
  //               -26.4688, -48.1250, -32.9688,  7.8750,
  //               -38.4375,  51.5625,  46.2188, -75.1875,  23.5625, -77.8125
  VLOAD_16(v2, 0x5299, 0x54a3, 0x35b4, 0x5618, 0x47d9, 0x52a7, 0xce9e, 0xd204, 0xd01f, 0x47e0, 0xd0ce, 0x5272, 0x51c7,
           0xd4b3, 0x4de4, 0xd4dd);
  //               49.6875,  28.5312,  13.4766, -90.5625,  58.0000,
  //               -63.8125,  49.0625,  0.3325,  30.8906,  11.2266, -93.9375,
  //               -54.6875,  61.7500,  38.3438,  95.8125,  10.0938
  VLOAD_16(v6, 0x5236, 0x4f22, 0x4abd, 0xd5a9, 0x5340, 0xd3fa, 0x5222, 0x3552, 0x4fb9, 0x499d, 0xd5df, 0xd2d6, 0x53b8,
           0x50cb, 0x55fd, 0x490c);
  //              -83.87223053, -48.34465408,  70.48658752, -1.26614821,
  //              -24.13150024, -65.13838196,
  //              0.84671319,  34.34510040,  72.80049896,
  //              -86.23424530,  25.52654839, -68.44364929,  9.81109142,
  //              -85.20966339, -81.00300598,  16.25512505
  VLOAD_32(v4, 0xc2a7be95, 0xc24160ed, 0x428cf922, 0xbfa21125, 0xc1c10d50, 0xc28246da, 0x3f58c232, 0x42096162,
           0x429199db, 0xc2ac77ef, 0x41cc365f, 0xc288e326, 0x411cfa3b, 0xc2aa6b59, 0xc2a2018a, 0x41820a7f);
  VLOAD_8(v0, 0xAA, 0xAA);
  asm volatile("vfwmacc.vv v4, v2, v6, v0.t");
  VSET(16, e32, m2);
  //              -83.87223053,  2068.31738281,  70.48658752, -8831.11035156,
  //              -24.13150024, -3461.15991211,
  //              0.84671319,  18.34259796,  72.80049896,  2.17493439,  25.52654839,
  //              -2888.26782227,  9.81109142, -2968.18041992, -81.00300598,
  //              -769.16479492
  VCMP_U32(2, v4, 0xc2a7be95, 0x45014514, 0x428cf922, 0xc609fc71, 0xc1c10d50, 0xc558528f, 0x3f58c232, 0x4192bda4,
           0x429199db, 0x400b3220, 0x41cc365f, 0xc5348449, 0x411cfa3b, 0xc53982e3, 0xc2a2018a, 0xc4404a8c);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //              -15.3750,  11.9375,
  //              -31.7656,  27.0625,  3.0684,  71.2500,  63.2500, -95.6875,
  //              -62.0625, -27.7344,  55.5312, -62.1875, -42.1875,
  //              -95.3125,  27.1406, -16.9219
  VLOAD_16(v2, 0xcbb0, 0x49f8, 0xcff1, 0x4ec4, 0x4223, 0x5474, 0x53e8, 0xd5fb, 0xd3c2, 0xceef, 0x52f1, 0xd3c6, 0xd146,
           0xd5f5, 0x4ec9, 0xcc3b);
  //              -70.22966003,  68.36327362, -69.75650787, -92.51078796,
  //              -53.56798553,
  //              -92.09814453,  92.33961487,  42.48206329,  99.15431976,
  //              -5.94871950, -55.92549133,  59.99367523, -45.05080032,
  //              -68.93397522,  55.13935089, -80.23659515
  VLOAD_32(v4, 0xc28c7596, 0x4288b9ff, 0xc28b8355, 0xc2b90586, 0xc256459e, 0xc2b83240, 0x42b8ade2, 0x4229eda2,
           0x42c64f03, 0xc0be5be9, 0xc25fb3b4, 0x426ff986, 0xc2343405, 0xc289de32, 0x425c8eb2, 0xc2a07923);
  //                              32.2812
  BOX_HALF_IN_FLOAT(fscalar_16, 0x5009);
  asm volatile("vfwmacc.vf v4, %[A], v2" ::[A] "f"(fscalar_16));
  VSET(16, e32, m2);
  //              -566.55389404,  453.72070312, -1095.19055176,
  //              781.10052490,  45.48249054,  2207.94091797,  2134.12866211,
  //              -3046.42993164, -1904.30078125, -901.24902344,  1736.69262695,
  //              -1947.49658203, -1406.91601562, -3145.74072266,  931.27264404,
  //              -626.49584961
  VCMP_U32(3, v4, 0xc40da373, 0x43e2dc40, 0xc488e619, 0x4443466f, 0x4235ee12, 0x4509ff0e, 0x4505620f, 0xc53e66e1,
           0xc4ee09a0, 0xc4614ff0, 0x44d9162a, 0xc4f36fe4, 0xc4afdd50, 0xc5449bda, 0x4468d173, 0xc41c9fbc);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m1);
  float fscalar_16;
  //               -15.3750,  11.9375,
  //               -31.7656,  27.0625,  3.0684,  71.2500,  63.2500, -95.6875,
  //               -62.0625, -27.7344,  55.5312, -62.1875, -42.1875,
  //               -95.3125,  27.1406, -16.9219
  VLOAD_16(v2, 0xcbb0, 0x49f8, 0xcff1, 0x4ec4, 0x4223, 0x5474, 0x53e8, 0xd5fb, 0xd3c2, 0xceef, 0x52f1, 0xd3c6, 0xd146,
           0xd5f5, 0x4ec9, 0xcc3b);
  //               -70.22966003,  68.36327362, -69.75650787, -92.51078796,
  //               -53.56798553,
  //               -92.09814453,  92.33961487,  42.48206329,  99.15431976,
  //               -5.94871950, -55.92549133,  59.99367523, -45.05080032,
  //               -68.93397522,  55.13935089, -80.23659515
  VLOAD_32(v4, 0xc28c7596, 0x4288b9ff, 0xc28b8355, 0xc2b90586, 0xc256459e, 0xc2b83240, 0x42b8ade2, 0x4229eda2,
           0x42c64f03, 0xc0be5be9, 0xc25fb3b4, 0x426ff986, 0xc2343405, 0xc289de32, 0x425c8eb2, 0xc2a07923);
  VLOAD_8(v0, 0xAA, 0xAA);
  //                              32.2812
  BOX_HALF_IN_FLOAT(fscalar_16, 0x5009);
  asm volatile("vfwmacc.vf v4, %[A], v2, v0.t" ::[A] "f"(fscalar_16));
  VSET(16, e32, m2);
  //               -70.22966003,  453.72070312, -69.75650787,  781.10052490,
  //               -53.56798553,  2207.94091797,  92.33961487,
  //               -3046.42993164,  99.15431976, -901.24902344, -55.92549133,
  //               -1947.49658203, -45.05080032, -3145.74072266,  55.13935089,
  //               -626.49584961
  VCMP_U32(4, v4, 0xc28c7596, 0x43e2dc40, 0xc28b8355, 0x4443466f, 0xc256459e, 0x4509ff0e, 0x42b8ade2, 0xc53e66e1,
           0x42c64f03, 0xc4614ff0, 0xc25fb3b4, 0xc4f36fe4, 0xc2343405, 0xc5449bda, 0x425c8eb2, 0xc41c9fbc);
};

int main(void) {
  enable_vec();
  enable_fp();

  TEST_CASE1();
  MASKED_TEST(TEST_CASE2());
  TEST_CASE3();
  MASKED_TEST(TEST_CASE4());

  EXIT_CHECK();
}
