# Allegro CODEC testbench

How to run a test:
```
make run_vcs VCS_RUN_DIR=<absolute path to a pre-built test>
```

All tests from the delivery were copy in /data/regression/europa/verif_team/decoder/<release_tag>.
This path is exported in the variable DECODER_TESTS_PATH

Examples:
```
make run_vcs VCS_RUN_OPTS="+ALLEGRO_TEST_PATH=$DECODER_TESTS_PATH/tests/g_custom/custom_axi_mcu/"
make run_vsim VSIM_RUN_OPTS="+ALLEGRO_TEST_PATH=$DECODER_TESTS_PATH/tests/g_custom/custom_axi_mcu/"
make run_vcs VCS_RUN_OPTS="+ALLEGRO_TEST_PATH=$DECODER_TESTS_PATH/tests/g_custom/custom/"
```

## System-Level Tests

It is possible to run system-level tests (generated by `$REPO_ROOT/sw/scripts/decoder/generate_decoder_testcase.sh`) using this testbench.
This is designed to sanity-check testcases, not for verifying the IP itself.
The actual verification using system-level testcases is done from software running on the APU.

The testbench can be configured for "system-level" mode using a plusarg: `+CODEC_SYSTEM_LEVEL_TESTCASE`.

While the required files (`*.mem`, `*.refmap`, ...) are not checked into the repository, they are generated by the Allegro testcase generation flow.
The following steps are required:
```sh
export AL_DELIVERY_DIR=/home/projects/allegro/delivery.Decoder_D300-R_RTL0p1
export CFG=$AL_DELIVERY_DIR/sim/tests/g_integration/JPG_128x64_400_8_1c0.cfg
$REPO_ROOT/sw/scripts/decoder/generate_decoder_testcase.sh --delivery $AL_DELIVERY_DIR --config $CFG
# testcase generated in $REPO_ROOT/sw/scripts/decoder/work/JPG_128x64_400_8_1c0/
make run_vcs VCS_RUN_OPTS="+ALLEGRO_TEST_PATH=$REPO_ROOT/sw/scripts/decoder/work/JPG_128x64_400_8_1c0/" PLUSARGS="+CODEC_SYSTEM_LEVEL_TESTCASE"
```

This also works when using the reference RTL testbenches in `ref`
